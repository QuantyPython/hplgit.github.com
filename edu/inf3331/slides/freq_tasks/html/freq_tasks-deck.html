<!DOCTYPE html>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Doconce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Frequently encountered operating system tasks in Python">








<!-- deck.js: https://github.com/imakewebthings/deck.js -->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=1024, user-scalable=no">

<!-- Required stylesheet -->
<link rel="stylesheet" href="deck.js/core/deck.core.css">

<!-- Extension CSS files go here. Remove or add as needed.
deck.goto: Adds a shortcut key to jump to any slide number.
Hit g, type in the slide number, and hit enter.

deck.hash: Enables internal linking within slides, deep
linking to individual slides, and updates the address bar and
a permalink anchor with each slide change.

deck.menu: Adds a menu view, letting you see all slides in a grid.
Hit m to toggle to menu view, continue navigating your deck,
and hit m to return to normal view. Touch devices can double-tap
the deck to switch between views.

deck.navigation: Adds clickable left and right buttons for the
less keyboard inclined.

deck.status: Adds a page number indicator. (current/total).

deck.scale: Scales each slide to fit within the deck container
using CSS Transforms for those browsers that support them.

deck.pointer: Turn mouse into laser pointer (toggle with p).
(Requires https://github.com/mikeharris100/deck.pointer.js)
-->

<link rel="stylesheet" href="deck.js/extensions/menu/deck.menu.css">
<link rel="stylesheet" href="deck.js/extensions/navigation/deck.navigation.css">
<link rel="stylesheet" href="deck.js/extensions/scale/deck.scale.css">
<link rel="stylesheet" href="deck.js/extensions/pointer/deck.pointer.css">
<link rel="stylesheet" href="deck.js/extensions/notes/deck.notes.css">
<!--
<link rel="stylesheet" href="deck.js/extensions/goto/deck.goto.css">
<link rel="stylesheet" href="deck.js/extensions/hash/deck.hash.css">
<link rel="stylesheet" href="deck.js/extensions/status/deck.status.css">
-->

<!-- Style theme. More available in themes/style/ or create your own. -->
<link rel="stylesheet" href="deck.js/themes/style/sandstone.default.css">

<!--
<link rel="stylesheet" href="deck.js/themes/style/neon.css">
<link rel="stylesheet" href="deck.js/themes/style/swiss.css">
<link rel="stylesheet" href="deck.js/themes/style/web-2.0.css">

git clone git://github.com/duijf/mnml.git
<link rel="stylesheet" href="deck.js/themes/style/mnml.css">

git://github.com/groovecoder/deckjs-theme-mozilla.git
<link rel="stylesheet" href="deck.js/themes/style/sandstone.css">
<link rel="stylesheet" href="deck.js/themes/style/sandstone.aurora.css">
<link rel="stylesheet" href="deck.js/themes/style/sandstone.dark.css">
<link rel="stylesheet" href="deck.js/themes/style/sandstone.default.css">
<link rel="stylesheet" href="deck.js/themes/style/sandstone.firefox.css">
<link rel="stylesheet" href="deck.js/themes/style/sandstone.light.css">
<link rel="stylesheet" href="deck.js/themes/style/sandstone.mdn.css">
<link rel="stylesheet" href="deck.js/themes/style/sandstone.nightly.css">
<link rel="stylesheet" href="deck.js/themes/style/sandstone.cbc.css">

git://github.com/barraq/deck.ext.js.git
<link rel="stylesheet" href="deck.js/themes/style/beamer.css">
-->

<!-- Transition theme. More available in /themes/transition/ or create your own. -->
<link rel="stylesheet" href="deck.js/themes/transition/horizontal-slide.css">
<!--
<link rel="stylesheet" href="deck.js/themes/transition/fade.css">
<link rel="stylesheet" href="deck.js/themes/transition/vertical-slide.css">
<link rel="stylesheet" href="deck.js/themes/transition/horizontal-slide.css">
-->

<!-- Required Modernizr file -->
<script src="deck.js/modernizr.custom.js"></script>

<style type="text/css">
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    p.caption { width: 80%; font-size: 60%; font-style: italic; text-align: left; }
    hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .slide .alert-text-small   { font-size: 80%;  }
    .slide .alert-text-large   { font-size: 130%; }
    .slide .alert-text-normal  { font-size: 90%;  }
    .slide .alert {
             padding:8px 35px 8px 14px; margin-bottom:18px;
             text-shadow:0 1px 0 rgba(255,255,255,0.5);
             border:5px solid #bababa;
               -webkit-border-radius:14px; -moz-border-radius:14px;
             border-radius:14px
             background-position: 10px 10px;
             background-repeat: no-repeat;
             background-size: 38px;
             padding-left: 30px; /* 55px; if icon */
     }
     .slide .alert-block {padding-top:14px; padding-bottom:14px}
     .slide .alert-block > p, .alert-block > ul {margin-bottom:0}
     /*.slide .alert li {margin-top: 1em}*/
     .deck .alert-block p+p {margin-top:5px}
     /*.slide .alert-notice { background-image: url(http://hplgit.github.io/doconce/bundled/html_images//small_gray_notice.png); }
     .slide .alert-summary  { background-image:url(http://hplgit.github.io/doconce/bundled/html_images//small_gray_summary.png); }
     .slide .alert-warning { background-image: url(http://hplgit.github.io/doconce/bundled/html_images//small_gray_warning.png); }
     .slide .alert-question {background-image:url(http://hplgit.github.io/doconce/bundled/html_images/small_gray_question.png); } */

</style>



<!-- Styles for table layout of slides -->
<style type="text/css">
td.padding {
  padding-top:20px;
  padding-bottom:20px;
  padding-right:50px;
  padding-left:50px;
}
</style>

</head>

<body class="deck-container">

<header>
<!-- Here goes a potential header -->
</header>

<!-- do not use the article tag - it gives strange sizings -->





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    



<section class="slide">
<!-- ------------------- main content ---------------------- -->


<title>Frequently encountered operating system tasks in Python</title>

<center><h1>Frequently encountered operating system tasks in Python</h1></center>  <!-- document title -->

<p>
<!-- author(s): Joakim Sundnes, Hans Petter Langtangen, and Ola Skavhaug -->

<center>
<b style="font-weight: bold">Joakim Sundnes</b> [1, 2]
</center>

<center>
<b style="font-weight: bold">Hans Petter Langtangen</b> [1, 2]
</center>

<center>
<b style="font-weight: bold">Ola Skavhaug</b> [3]
</center>


<p>
<!-- institution(s) -->

<center>[1] <b style="font-weight: bold">Center for Biomedical Computing, Simula Research Laboratory</b></center>
<center>[2] <b style="font-weight: bold">Dept. of Informatics, University of Oslo</b></center>
<center>[3] <b style="font-weight: bold">mCASH (formerly Dept. of Informatics, University of Oslo)</b></center>
<p>
<center><h4>Aug 25, 2014</h4></center> <!-- date -->
<p>

</section>


<section class="slide">

<h2>Program Python instead of Bash?  <a name="___sec0"></a></h2>

<div class="alert alert-block alert-summary alert-text-normal"><b style="font-weight: bold">Essence:</b>
We can do Bash operations in Python too, in a cross-platform fashion
(Mac, Windows, Linux) and with much more flexibility for extensions.
</div>


<p>
Topics to be covered:

<ul>
  <p><li> environment variables</li>
  <p><li> file globbing, testing file types</li>
  <p><li> copying and renaming files, creating and moving to directories, creating directory paths, removing files and directories</li>
  <p><li> directory tree traversal</li>
  <p><li> parsing command-line arguments</li>
  <p><li> running an application from a script</li>
  <p><li> Text processing (some repetition)</li>
  <p><li> use of <code>split, join</code></li>
  <p><li> searching and substituting</li>
</ul>
<p>


</section>


<section class="slide">

<h2>Environment variables  <a name="___sec1"></a></h2>

The dictionary-like <code>os.environ</code> object holds the environment variables:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; os.environ[<span style="color: #CD5555">&#39;PATH&#39;</span>]
<span style="color: #CD5555">&#39;/users/me/bin:/bin:/usr/sbin/:/some/strange/path&#39;</span>
&gt;&gt;&gt; os.environ[<span style="color: #CD5555">&#39;HOME&#39;</span>]
<span style="color: #CD5555">&#39;/users/me&#39;</span>
&gt;&gt;&gt; os.environ[<span style="color: #CD5555">&#39;PYTHONPATH&#39;</span>]
<span style="color: #CD5555">&#39;/users/me/mypy/lib:/users/you/yourpy/new/lib&#39;</span>

&gt;&gt;&gt; os.environ[<span style="color: #CD5555">&#39;my_self_defined_environment_variable&#39;</span>] = <span style="color: #CD5555">&#39;ON&#39;</span>
&gt;&gt;&gt; os.environ[<span style="color: #CD5555">&#39;my_self_defined_environment_variable&#39;</span>]
<span style="color: #CD5555">&#39;ON&#39;</span>
</pre></div>
<p>
Write all the environment variables in alphabethic order:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">for</span> var <span style="color: #8B008B">in</span> <span style="color: #658b00">sorted</span>(os.environ):
    <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;%s=%s&#39;</span> % (var, os.environ[var])
</pre></div>
<p>

</section>


<section class="slide">

<h2>File globbing: list files that match a wildcard expression  <a name="___sec2"></a></h2>

List all <code>.pdf</code> and <code>.gif files</code> in the current directory (Unix):

<p>

<!-- code=text (!bc sys) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt; ls *.pdf *.gif
</pre></div>
<p>
Cross-platform way to do it in Python:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">glob</span>
filelist = glob.glob(<span style="color: #CD5555">&#39;*.pdf&#39;</span>) + glob.glob(<span style="color: #CD5555">&#39;*.gif&#39;</span>)
</pre></div>
<p>
<div class="alert alert-block alert-block alert-text-normal"><b style="font-weight: bold"></b>
This is referred to as <em>file globbing</em>.
</div>


<p>
More sophisticated example: find all files not starting with <code>P</code> or <code>p</code>,
followed by any string, then two numbers, and then and ending in <code>.txt</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">filelist = glob.glob(<span style="color: #CD5555">&#39;[!Pp]*[0-9][0-9].txt&#39;</span>)
</pre></div>
<p>

</section>


<section class="slide">

<h2>Finding file type, size, age  <a name="___sec3"></a></h2>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">os.path</span>
<span style="color: #8B008B; font-weight: bold">print</span> myfile,

<span style="color: #8B008B; font-weight: bold">if</span> os.path.isfile(myfile):
     <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;is a plain file&#39;</span>

<span style="color: #8B008B; font-weight: bold">if</span> os.path.isdir(myfile):
     <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;is a directory&#39;</span>

<span style="color: #8B008B; font-weight: bold">if</span> os.path.islink(myfile):
     <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;is a link&#39;</span>

<span style="color: #228B22"># the size and age:</span>
size = os.path.getsize(myfile)
time_of_last_access       = os.path.getatime(myfile)
time_of_last_modification = os.path.getmtime(myfile)

<span style="color: #228B22"># times are measured in seconds since 1970.01.01</span>
days_since_last_access = \
(time.time() - os.path.getatime(myfile))/(<span style="color: #B452CD">3600</span>*<span style="color: #B452CD">24</span>)
</pre></div>
<p>

</section>


<section class="slide">

<h2>More detailed file info via <code>os.stat</code>  <a name="___sec4"></a></h2>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">stat</span>

myfile_stat = os.stat(myfile)

filesize = myfile_stat[stat.ST_SIZE]

mode = myfile_stat[stat.ST_MODE]

<span style="color: #8B008B; font-weight: bold">if</span> stat.S_ISREG(mode):
    <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;%(myfile)s is a regular file &#39;</span>\
          <span style="color: #CD5555">&#39;with %(filesize)d bytes&#39;</span> % <span style="color: #658b00">vars</span>()
</pre></div>
<p>
Check out the <code>stat</code> module in the <a href="https://docs.python.org/2/library/os.html?highlight=os.stat#os.stat" target="_blank">Python Library Reference</a>

<p>

</section>


<section class="slide">

<h2>Copy, rename and remove files  <a name="___sec5"></a></h2>

Copy a file:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">shutil</span>
shutil.copy(myfile, tmpfile)
</pre></div>
<p>
Rename a file:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">os.rename(myfile, <span style="color: #CD5555">&#39;tmp.1&#39;</span>)
</pre></div>
<p>
Remove a file:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">os.remove(<span style="color: #CD5555">&#39;mydata.dat&#39;</span>)
<span style="color: #228B22"># or os.unlink(&#39;mydata.dat&#39;)</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>Use <code>os.path.join</code> for file path construction  <a name="___sec6"></a></h2>

Cross-platform construction of file paths:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">filename = os.path.join(os.pardir, <span style="color: #CD5555">&#39;src&#39;</span>, <span style="color: #CD5555">&#39;lib&#39;</span>)

<span style="color: #228B22"># Unix:    ../src/lib</span>
<span style="color: #228B22"># Windows: ..\src\lib</span>
</pre></div>
<p>
Current directory is <code>os.curdir</code>, parent directory is <code>os.pardir</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #228B22"># Unix:  cp ../../myfile .</span>
shutil.copy(os.path.join(os.pardir, os.pardir, filename), os.curdir)
</pre></div>
<p>

</section>


<section class="slide">

<h2>Directory management  <a name="___sec7"></a></h2>

Creating and moving to directories:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">dirname = <span style="color: #CD5555">&#39;mynewdir&#39;</span>
<span style="color: #8B008B; font-weight: bold">if</span> <span style="color: #8B008B">not</span> os.path.isdir(dirname):
    os.mkdir(dirname) <span style="color: #228B22"># or os.mkdir(dirname, mode=&#39;0755&#39;)</span>
os.chdir(dirname)
</pre></div>
<p>
Equivalent Bash commands:

<p>

<!-- code=text (!bc sys) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt; dirname=mynewdir
&gt; mkdir $dirname
&gt; cd $dirname
</pre></div>
<p>
Make complete directory path with intermediate directories:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">path = os.path.join(os.environ[<span style="color: #CD5555">&#39;HOME&#39;</span>], <span style="color: #CD5555">&#39;py&#39;</span>, <span style="color: #CD5555">&#39;src&#39;</span>)
os.makedirs(path)

<span style="color: #228B22"># Unix: mkdirhier $HOME/py/src or mkdir -p $HOME/py/src</span>
</pre></div>
<p>
Remove a non-empty directory tree:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">shutil.rmtree(<span style="color: #CD5555">&#39;somedir&#39;</span>)   <span style="color: #228B22"># dangerous - know what you do!</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>Basename and directory of a path  <a name="___sec8"></a></h2>

Given a path, e.g.,

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">path = <span style="color: #CD5555">&#39;/home/me/scripting/python/intro/hw.py&#39;</span>
</pre></div>
<p>
Extract directory and basename:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #228B22"># basename: hw.py</span>
basename = os.path.basename(path)

<span style="color: #228B22"># dirname: /home/me/scripting/python/intro</span>
dirname  = os.path.dirname(path)

<span style="color: #228B22"># or</span>
dirname, basename = os.path.split(path)
</pre></div>
<p>
Extract file suffix/extension:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">stem, suffix = os.path.splitext(path)
<span style="color: #228B22"># stem: /home/me/scripting/python/intro/hw</span>
<span style="color: #228B22"># suffix: .py</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>Platform-dependent operations  <a name="___sec9"></a></h2>

The operating system interface in Python is the same on Unix, Windows and Mac
However, sometimes you need to perform platform-specific operations, but how can you make a portable script?

<p>
Key variables:

<ul>
 <p><li> <code>os.name</code>: operating system name</li>
 <p><li> <code>sys.platform</code>: platform identifier</li>
</ul>
<p>

Example: <code>cmd</code> holds a command to be run in the background

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">if</span> os.name == <span style="color: #CD5555">&#39;posix&#39;</span>:            <span style="color: #228B22"># Unix?</span>
  failure = os.system(cmd + <span style="color: #CD5555">&#39;&amp;&#39;</span>)

<span style="color: #8B008B; font-weight: bold">elif</span> sys.platform[:<span style="color: #B452CD">3</span>] == <span style="color: #CD5555">&#39;win&#39;</span>:   <span style="color: #228B22"># Windows?</span>
  failure = os.system(<span style="color: #CD5555">&#39;start &#39;</span> + cmd)
</pre></div>
<p>

</section>


<section class="slide">

<h2>Traversing directory trees with <code>find</code> in Bash  <a name="___sec10"></a></h2>

Run through all files in your home directory and list files that are larger than 1 Mb:

<p>

<!-- code=text (!bc sys) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt; find $HOME -type f -size +1000k -exec ls -s -h {} \;
</pre></div>
<p>
This (and all features of Unix find) can be given a cross-platform
implementation in Python so it works on Windows too

<p>

</section>


<section class="slide">

<h2>Traversing directory trees with <code>os.path.walk</code> in Python  <a name="___sec11"></a></h2>

Run through all files in your home directory and list files that are larger than 1 Mb:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">root = os.environ[<span style="color: #CD5555">&#39;HOME&#39;</span>]             <span style="color: #228B22"># home directory</span>
os.path.walk(root, myfunc, arg)
</pre></div>
<p>
<code>os.path.walk</code> walks through a directory tree (<code>root</code>)
and calls, for each directory <code>dirname</code>,

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">myfunc(arg, dirname, files)
</pre></div>
<p>
where

<ul>
 <p><li> <code>files</code> is the list of local filenames in directory <code>dirname</code></li>
 <p><li> <code>arg</code> is any user-defined argument, e.g., a nested list of variables</li>
</ul>
<p>


</section>


<section class="slide">

<h2>Example on finding large files with <code>os.path.walk</code>  <a name="___sec12"></a></h2>


<!-- code=python (!bc pypro) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">os</span>

<span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">checksize</span>(arg, dirname, files):
    <span style="color: #8B008B; font-weight: bold">for</span> <span style="color: #658b00">file</span> <span style="color: #8B008B">in</span> files:
        <span style="color: #228B22"># construct the file&#39;s complete path:</span>
        filename = os.path.join(dirname, <span style="color: #658b00">file</span>)
        <span style="color: #8B008B; font-weight: bold">if</span> os.path.isfile(filename):
            size = os.path.getsize(filename)
            <span style="color: #8B008B; font-weight: bold">if</span> size &gt; <span style="color: #B452CD">1000000</span>:
                <span style="color: #8B008B; font-weight: bold">if</span> arg <span style="color: #8B008B">is</span> <span style="color: #658b00">None</span>:
                    <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;%.2fMb %s&#39;</span> % (size/<span style="color: #B452CD">1000000.0</span>,filename)
                <span style="color: #8B008B; font-weight: bold">elif</span> <span style="color: #658b00">isinstance</span>(arg, <span style="color: #658b00">list</span>):
                    arg.append((size/<span style="color: #B452CD">1000000.0</span>,filename))

root = os.environ[<span style="color: #CD5555">&#39;HOME&#39;</span>]
os.path.walk(root, checksize, <span style="color: #658b00">None</span>)  <span style="color: #228B22"># print list of large files</span>

arg = []
os.path.walk(root, checksize, arg)
<span style="color: #228B22"># arg is now a list of large files</span>
<span style="color: #8B008B; font-weight: bold">for</span> size, filename <span style="color: #8B008B">in</span> arg:
    <span style="color: #8B008B; font-weight: bold">print</span> filename, <span style="color: #CD5555">&#39;has size&#39;</span>, size, <span style="color: #CD5555">&#39;Mb&#39;</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>Time for a bug!  <a name="___sec13"></a></h2>

In the previous example, let's use a tuple instead of a list:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">checksize2</span>(arg, dirname, files):
    <span style="color: #8B008B; font-weight: bold">for</span> <span style="color: #658b00">file</span> <span style="color: #8B008B">in</span> files:
        <span style="color: #228B22"># construct the file&#39;s complete path:</span>
        filename = os.path.join(dirname, <span style="color: #658b00">file</span>)
        <span style="color: #8B008B; font-weight: bold">if</span> os.path.isfile(filename):
            size = os.path.getsize(filename)
            <span style="color: #8B008B; font-weight: bold">if</span> size &gt; <span style="color: #B452CD">1000000</span>:
                <span style="color: #8B008B; font-weight: bold">if</span> arg <span style="color: #8B008B">is</span> <span style="color: #658b00">None</span>:
                    <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;%.2fMb %s&#39;</span> % (size/<span style="color: #B452CD">1000000.0</span>,filename)
                <span style="color: #8B008B; font-weight: bold">elif</span> <span style="color: #658b00">isinstance</span>(arg, <span style="color: #658b00">list</span>):
                    arg = arg + ((size/<span style="color: #B452CD">1000000.0</span>,filename))

root = os.environ[<span style="color: #CD5555">&#39;HOME&#39;</span>]
arg = ()
os.path.walk(root, checksize2, arg)
</pre></div>
<p>
<div class="alert alert-block alert-question alert-text-normal"><b style="font-weight: bold">Question.</b>
Why is <code>arg</code> an empty tuple after the call?
</div>


<p>

</section>


<section class="slide">

<h2>Example on finding large files with <code>os.walk</code>  <a name="___sec14"></a></h2>

<code>os.walk(root, followlinks=False)</code> is an iterator:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">for</span> dirpath, dirnames, filenames <span style="color: #8B008B">in</span> os.walk(root):
</pre></div>
<p>
Here,

<ul>
  <p><li> <code>dirpath</code> is the complete path, relative to <code>root</code>, to
    a subdirectory</li>
  <p><li> <code>dirnames</code> are the names of the subdirectories in <code>dirpath</code></li>
  <p><li> <code>filenames</code> are the names of ordinary files in <code>dirpath</code></li>
</ul>
<p>

Previous example programmed with <code>os.walk</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">arg = []
<span style="color: #8B008B; font-weight: bold">for</span> dirpath, dirnames, filenames <span style="color: #8B008B">in</span> os.walk(root):
    checksize(arg, dirpath, dirnames + filenames)
</pre></div>
<p>

</section>


<section class="slide">

<h2>Creating tar archives for file collections  <a name="___sec15"></a></h2>

Bash:

<p>

<!-- code=text (!bc sys) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt; tar czf tmp.tar.gz myfile.py yourfile.f mydirectory
</pre></div>
<p>
Cross-platform Python:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; <span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">tarfile</span>
&gt;&gt;&gt; files = <span style="color: #CD5555">&#39;myfile.py&#39;</span>, <span style="color: #CD5555">&#39;yourfile.f&#39;</span>, <span style="color: #CD5555">&#39;mydirectory&#39;</span>
&gt;&gt;&gt; tar = tarfile.open(<span style="color: #CD5555">&#39;tmp.tar.gz&#39;</span>, <span style="color: #CD5555">&#39;w:gz&#39;</span>)  <span style="color: #228B22"># gzip compression</span>
&gt;&gt;&gt; <span style="color: #8B008B; font-weight: bold">for</span> <span style="color: #658b00">file</span> <span style="color: #8B008B">in</span> files:
...     tar.add(<span style="color: #658b00">file</span>)
...
&gt;&gt;&gt; <span style="color: #228B22"># check what&#39;s in this archive:</span>
&gt;&gt;&gt; members = tar.getmembers()  <span style="color: #228B22"># list of TarInfo objects</span>
&gt;&gt;&gt; <span style="color: #8B008B; font-weight: bold">for</span> info <span style="color: #8B008B">in</span> members:
...     <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;%s: size=%d, mode=%s, mtime=%s&#39;</span> % \
...           (info.name, info.size, info.mode,
...            time.strftime(<span style="color: #CD5555">&#39;%Y.%m.%d&#39;</span>, time.gmtime(info.mtime)))
...
myfile.py: size=<span style="color: #B452CD">11898</span>, mode=<span style="color: #B452CD">33261</span>, mtime=<span style="color: #B452CD">2004.11</span>.<span style="color: #B452CD">23</span>
yourfile.f: size=<span style="color: #B452CD">206</span>, mode=<span style="color: #B452CD">33261</span>, mtime=<span style="color: #B452CD">2005.08</span>.<span style="color: #B452CD">12</span>
mydirectory/file1.py: size=<span style="color: #B452CD">1560</span>, mode=<span style="color: #B452CD">33261</span>, mtime=<span style="color: #B452CD">2014.09</span>.<span style="color: #B452CD">14</span>
mydirectory/file2.py: size27560, mode=<span style="color: #B452CD">33261</span>, mtime=<span style="color: #B452CD">2014.08</span>.<span style="color: #B452CD">08</span>
&gt;&gt;&gt; tar.close()
</pre></div>
<p>
Compressions: uncompressed (<code>w:</code>), gzip (<code>w:gz</code>), bzip2 (<code>w:bz2</code>)

<p>

</section>


<section class="slide">

<h2>Reading tar archives  <a name="___sec16"></a></h2>


<!-- code=python (!bc pyshell) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; tar = tarfile.open(<span style="color: #CD5555">&#39;tmp.tar.gz&#39;</span>, <span style="color: #CD5555">&#39;r&#39;</span>)
&gt;&gt;&gt;
&gt;&gt;&gt; <span style="color: #8B008B; font-weight: bold">for</span> <span style="color: #658b00">file</span> <span style="color: #8B008B">in</span> tar.getmembers():
...     tar.extract(<span style="color: #658b00">file</span>)   <span style="color: #228B22"># extract file to current working dir.</span>
...
&gt;&gt;&gt; f = tar.extractfile(<span style="color: #CD5555">&#39;myfile.py&#39;</span>)  <span style="color: #228B22"># extract as file object</span>
&gt;&gt;&gt; f.readlines()
</pre></div>
<p>

</section>


<section class="slide">

<h2>Parsing command-line arguments  <a name="___sec17"></a></h2>

<ul>
  <p><li> Three types of command-line options: <code>myprog.py arg1 arg2 -m 1.5 --mass 2.5</code></li>

<ol>
   <p><li> positional arguments: <code>arg1</code>, <code>arg2</code></li>
   <p><li> option-value pair with short option: <code>-m</code></li>
   <p><li> option-value pair with long option: <code>--mass</code></li>
</ol>
<p>

  <p><li> Running through <code>sys.argv[1:]</code> and extracting command-line info &quot;manually&quot; is easy</li>
  <p><li> Using standardized modules and interface specifications is better!</li>
  <p><li> The standard module is <code>argparse</code></li>
</ul>
<p>


</section>


<section class="slide">

<h2>A case involving option-value pairs and the <code>argparse</code> module  <a name="___sec18"></a></h2>

We have some program with four parameters \( v_0 \), \( s_0 \), \( a \), and \( t \),
corresponding to logical names <em>initial velocity</em>, <em>initial position</em>,
<em>acceleration</em>, and <em>time</em>.

<p>
All these have sensible default values.
We use command-line option-value pairs to override default values
(cf. keyword arguments).

<p>
The user can choose between long and short options, but we let
short options also have double hyphen:

<p>

<!-- code=text (!bc sys) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt; python position.py --v0 1.0 --acceleration 0.9
&gt; python position.py --initial_velocity 1.0 --a 0.9 --t 3
</pre></div>
<p>

</section>


<section class="slide">

<h2>How to use <code>argparse</code>  <a name="___sec19"></a></h2>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">argparse</span>
parser = argparse.ArgumentParser()

<span style="color: #228B22"># Define command-line arguments</span>
parser.add_argument(<span style="color: #CD5555">&#39;--v0&#39;</span>, <span style="color: #CD5555">&#39;--initial_velocity&#39;</span>, <span style="color: #658b00">type</span>=<span style="color: #658b00">float</span>,
                    default=<span style="color: #B452CD">0.0</span>, help=<span style="color: #CD5555">&#39;initial velocity&#39;</span>)

parser.add_argument(<span style="color: #CD5555">&#39;--s0&#39;</span>, <span style="color: #CD5555">&#39;--initial_position&#39;</span>, <span style="color: #658b00">type</span>=<span style="color: #658b00">float</span>,
                    default=<span style="color: #B452CD">0.0</span>, help=<span style="color: #CD5555">&#39;initial position&#39;</span>)

parser.add_argument(<span style="color: #CD5555">&#39;--a&#39;</span>, <span style="color: #CD5555">&#39;--acceleration&#39;</span>, <span style="color: #658b00">type</span>=<span style="color: #658b00">float</span>,
                    default=<span style="color: #B452CD">1.0</span>, help=<span style="color: #CD5555">&#39;acceleration&#39;</span>)

parser.add_argument(<span style="color: #CD5555">&#39;--t&#39;</span>, <span style="color: #CD5555">&#39;--time&#39;</span>, <span style="color: #658b00">type</span>=<span style="color: #658b00">float</span>,
                    default=<span style="color: #B452CD">1.0</span>, help=<span style="color: #CD5555">&#39;time&#39;</span>)

<span style="color: #228B22"># Read the command line and interpret the arguments</span>
args = parser.parse_args()

<span style="color: #228B22"># Extract values</span>
s = args.s0 + args.v0*t + <span style="color: #B452CD">0.5</span>*args.a*args.t**<span style="color: #B452CD">2</span>
<span style="color: #228B22"># or</span>
s0 = args.s0; v0 = args.v0; a = args.a; t = args.t
s = s0 + v0*t + <span style="color: #B452CD">0.5</span>*a*t**<span style="color: #B452CD">2</span>
</pre></div>
<p>
See the <a href="https://docs.python.org/2/library/argparse.html?highlight=argparse#argparse" target="_blank">documentation of argparse</a> for more examples

<p>

</section>


<section class="slide">

<h2>Writing Python data structures to file  <a name="___sec20"></a></h2>

Write nested lists to file using <code>str</code> for converting an object to a string:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">somelist = [<span style="color: #CD5555">&#39;text1&#39;</span>, <span style="color: #CD5555">&#39;text2&#39;</span>]
a = [[<span style="color: #B452CD">1.3</span>,somelist], <span style="color: #CD5555">&#39;some text&#39;</span>]
f = <span style="color: #658b00">open</span>(<span style="color: #CD5555">&#39;tmp.dat&#39;</span>, <span style="color: #CD5555">&#39;w&#39;</span>)

<span style="color: #228B22"># convert data structure to its string representation:</span>
f.write(<span style="color: #658b00">str</span>(a))
f.close()
</pre></div>
<p>
<code>tmp.dat</code>:

<p>

<!-- code=text (!bc dat) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">[[1.3, [&#39;text1&#39;, &#39;text2&#39;]], &#39;some text&#39;]
</pre></div>
<p>
Writing to standard output: <code>print a</code> implies <code>print str(a)</code>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">print</span> a     <span style="color: #228B22"># v2.x</span>
<span style="color: #8B008B; font-weight: bold">print</span>(a)    <span style="color: #228B22"># v3.x</span>
sys.stdout.write(<span style="color: #658b00">str</span>(a) + <span style="color: #CD5555">&#39;\n&#39;</span>)  <span style="color: #228B22"># standard output file object</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>Reading Python data structures from file  <a name="___sec21"></a></h2>

<ul>
 <p><li> <code>eval(s)</code>: turn string <code>s</code> into live Python code</li>
 <p><li> <code>a = eval(str(a))</code> is a valid &quot;equation&quot; for basic Python data structures
   (since <code>str(a)</code> turns <code>a</code> into a string with valid Python syntax for
   defining <code>a</code>, and <code>eval</code> turns the string back into a living Python object)</li>
</ul>
<p>

Last slide created <code>tmp.dat</code>:

<p>

<!-- code=text (!bc dat) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">[[1.3, [&#39;text1&#39;, &#39;text2&#39;]], &#39;some text&#39;]
</pre></div>
<p>
Read this nested list back into a Python object <code>a</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">f = <span style="color: #658b00">open</span>(<span style="color: #CD5555">&#39;tmp.dat&#39;</span>, <span style="color: #CD5555">&#39;r&#39;</span>)
<span style="color: #228B22"># evaluate first line in file as Python code:</span>
a = <span style="color: #658b00">eval</span>(f.readline())
</pre></div>
<p>
Now, <code>a</code> is

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">[[<span style="color: #B452CD">1.3</span>, [<span style="color: #CD5555">&#39;text1&#39;</span>, <span style="color: #CD5555">&#39;text2&#39;</span>]], <span style="color: #CD5555">&#39;some text&#39;</span>]

<span style="color: #228B22"># i.e.</span>
a = <span style="color: #658b00">eval</span>(f.readline())
<span style="color: #228B22"># is the same as</span>
a = [[<span style="color: #B452CD">1.3</span>, [<span style="color: #CD5555">&#39;text1&#39;</span>, <span style="color: #CD5555">&#39;text2&#39;</span>]], <span style="color: #CD5555">&#39;some text&#39;</span>]
</pre></div>
<p>

</section>


<section class="slide">

<h2>Remark about <code>str</code>, <code>repr</code>, and <code>eval</code>  <a name="___sec22"></a></h2>

<ul>
 <p><li> <code>str(a)</code> is used for &quot;pretty print&quot; and defined by the object's
   special method <code>__str__</code></li>
 <p><li> <code>repr(a)</code> is used for &quot;string representation&quot; of the object
   and defined by the object's special method <code>__repr__</code></li>
 <p><li> Strictly speaking, <code>eval(repr(a))</code> recreates <code>a</code>, while
   <code>eval(str(a))</code> is not always meaningful if <code>str(a)</code> is a pretty print
   of the object and not exactly the syntax needed to create the object</li>
 <p><li> For the Python standard objects (numbers, lists, tuples, dicts),
   <code>str(a)</code> and <code>repr(a)</code> are the same</li>
</ul>
<p>


</section>


<section class="slide">

<h2>A class with tailored <code>str</code> and <code>repr</code>  <a name="___sec23"></a></h2>


<!-- code=python (!bc pypro) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #008b45; font-weight: bold">LinearFunction</span>:
    <span style="color: #CD5555">&quot;&quot;&quot;Represent a linear function a*x + b.&quot;&quot;&quot;</span>

    <span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">__init__</span>(<span style="color: #658b00">self</span>, a, b):
        <span style="color: #658b00">self</span>.a, <span style="color: #658b00">self</span>.b = a, b

    <span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">__call__</span>(<span style="color: #658b00">self</span>, x):
        <span style="color: #8B008B; font-weight: bold">return</span> <span style="color: #658b00">self</span>.a*x + <span style="color: #658b00">self</span>.b

    <span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">__str__</span>(<span style="color: #658b00">self</span>):
        <span style="color: #CD5555">&quot;&quot;&quot;Return pretty print of function: -1.3*x - 4.&quot;&quot;&quot;</span>
        <span style="color: #8B008B; font-weight: bold">return</span> <span style="color: #CD5555">&#39;%s*x %s %s&#39;</span> % (<span style="color: #658b00">self</span>.a,
                               <span style="color: #CD5555">&#39;+ if self.b &gt; 0 else &#39;</span>-<span style="color: #CD5555">&#39;,  # right sign</span>
                               <span style="color: #658b00">abs</span>(<span style="color: #658b00">self</span>.b))

    <span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">__repr</span>(<span style="color: #658b00">self</span>):
        <span style="color: #8B008B; font-weight: bold">return</span> <span style="color: #CD5555">&#39;LinearFunction(%s, %s)&#39;</span> % (<span style="color: #658b00">self</span>.a, <span style="color: #658b00">self</span>.b)
</pre></div>
<p>

</section>


<section class="slide">

<h2>Illustration of <code>str</code>, <code>repr</code>, and <code>eval</code>  <a name="___sec24"></a></h2>


<!-- code=python (!bc pyshell) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; f = LinearFunction(-<span style="color: #B452CD">1</span>, <span style="color: #B452CD">2</span>)
&gt;&gt;&gt; <span style="color: #658b00">str</span>(a)   <span style="color: #228B22"># calls f.__str__()</span>
<span style="color: #CD5555">&#39;-1*x + 2&#39;</span>
&gt;&gt;&gt; <span style="color: #658b00">eval</span>(<span style="color: #658b00">str</span>(a))
Traceback (most recent call last):
...
<span style="color: #008b45; font-weight: bold">NameError</span>: name <span style="color: #CD5555">&#39;x&#39;</span> <span style="color: #8B008B">is</span> <span style="color: #8B008B">not</span> defined
&gt;&gt;&gt; <span style="color: #658b00">repr</span>(a)
<span style="color: #CD5555">&#39;LinearFunction(-1, 2)&#39;</span>
&gt;&gt;&gt; new_a = <span style="color: #658b00">eval</span>(<span style="color: #658b00">repr</span>(a))
&gt;&gt;&gt; <span style="color: #658b00">str</span>(new_a)
<span style="color: #CD5555">&#39;-1*x + 2&#39;</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>Persistence: permanent storage of data structures  <a name="___sec25"></a></h2>

<ul>
  <p><li> Many programs need to have persistent data structures, i.e., the data live after the program is terminated and can be retrieved the next time the program is executed</li>
  <p><li> <code>str</code>, <code>repr</code> and <code>eval</code> are convenient for making data structures persistent</li>
  <p><li> <code>pickle</code>, <code>cPickle</code> and <code>shelve</code> are other (more sophisticated) Python modules for implementing persistence</li>
</ul>
<p>


</section>


<section class="slide">

<h2>Pickling is used for storing a sequence of objects  <a name="___sec26"></a></h2>

Write <em>any</em> set of data structures to file using
the <code>pickle</code> module:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">f = <span style="color: #658b00">open</span>(filename, <span style="color: #CD5555">&#39;w&#39;</span>)
<span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">pickle</span>
pickle.dump(a1, f)
pickle.dump(a2, f)
pickle.dump(a3, f)
f.close()
</pre></div>
<p>
<div class="alert alert-block alert-warning alert-text-normal"><b style="font-weight: bold">Remark:</b>
In v2.x, cPickle is a faster version than pickle, but
works in the same way. In 3.x, <code>pickle</code> is <code>cPickle</code>.
</div>


<p>
Read data structures in again later (the sequence is important):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">f = <span style="color: #658b00">open</span>(filename, <span style="color: #CD5555">&#39;r&#39;</span>)
a1 = pickle.load(f)
a2 = pickle.load(f)
a3 = pickle.load(f)
</pre></div>
<p>

</section>


<section class="slide">

<h2>Shelving  <a name="___sec27"></a></h2>

Think of shelves as dictionaries with file storage:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">shelve</span>
database = shelve.open(filename)
database[<span style="color: #CD5555">&#39;a1&#39;</span>] = a1  <span style="color: #228B22"># store a1 under the key &#39;a1&#39;</span>
database[<span style="color: #CD5555">&#39;a2&#39;</span>] = a2
database[<span style="color: #CD5555">&#39;a3&#39;</span>] = a3
<span style="color: #228B22"># or</span>
database[<span style="color: #CD5555">&#39;a123&#39;</span>] = (a1, a2, a3)

<span style="color: #228B22"># retrieve data:</span>
<span style="color: #8B008B; font-weight: bold">if</span> <span style="color: #CD5555">&#39;a1&#39;</span> <span style="color: #8B008B">in</span> database:
    a1 = database[<span style="color: #CD5555">&#39;a1&#39;</span>]
<span style="color: #228B22"># and so on</span>

<span style="color: #228B22"># delete an entry:</span>
<span style="color: #8B008B; font-weight: bold">del</span> database[<span style="color: #CD5555">&#39;a2&#39;</span>]

database.close()
</pre></div>
<p>

</section>


<section class="slide">

<h2>Running an application (old-style)  <a name="___sec28"></a></h2>

Run a stand-alone program:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">cmd = <span style="color: #CD5555">&#39;myprog -c file.1 -p -f -q &gt; res&#39;</span>
failure = os.system(cmd)
<span style="color: #8B008B; font-weight: bold">if</span> failure:
    <span style="color: #8B008B; font-weight: bold">print</span> cmd, <span style="color: #CD5555">&#39;failed&#39;</span>
    sys.exit(<span style="color: #B452CD">1</span>)
</pre></div>
<p>
Redirect output from the application to a list of lines:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">pipe = os.popen(cmd)
output = pipe.readlines()
pipe.close()

<span style="color: #8B008B; font-weight: bold">for</span> line <span style="color: #8B008B">in</span> output:
  <span style="color: #228B22"># process line</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>The new standard: <code>subprocess</code>  <a name="___sec29"></a></h2>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">subprocess</span> <span style="color: #8B008B; font-weight: bold">import</span> call
cmd = <span style="color: #CD5555">&#39;myprog -c file.1 -p -f -q &gt; res&#39;</span>
<span style="color: #8B008B; font-weight: bold">try</span>:
    returncode = call(cmd, shell=<span style="color: #658b00">True</span>)
    <span style="color: #8B008B; font-weight: bold">if</span> returncode:
        <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;failure&#39;</span>  <span style="color: #228B22"># returncode has no meaning when != 0</span>
        sys.exit(<span style="color: #B452CD">1</span>)
<span style="color: #8B008B; font-weight: bold">except</span> <span style="color: #008b45; font-weight: bold">OSError</span>, message:
    <span style="color: #8B008B; font-weight: bold">print</span> <span style="color: #CD5555">&#39;execution failed!\n&#39;</span>, message
    sys.exit(<span style="color: #B452CD">1</span>)
</pre></div>
<p>
Grab the output using <code>subprocess.Popen</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">subprocess</span> <span style="color: #8B008B; font-weight: bold">import</span> Popen, PIPE
p = Popen(cmd, shell=<span style="color: #658b00">True</span>, stdout=PIPE)
output, errors = p.communicate()

<span style="color: #228B22"># output: text written to standard output</span>
<span style="color: #228B22"># errors: text written to standard error</span>

<span style="color: #8B008B; font-weight: bold">for</span> line <span style="color: #8B008B">in</span> output.splitlines():
    <span style="color: #8B008B; font-weight: bold">print</span> line
</pre></div>
<p>

</section>


<section class="slide">

<h2>Output pipe  <a name="___sec30"></a></h2>

Open (in a script) a dialog with an interactive program:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">subprocess</span> <span style="color: #8B008B; font-weight: bold">import</span> Popen, PIPE
pipe = Popen(<span style="color: #CD5555">&#39;gnuplot -persist&#39;</span>, shell=<span style="color: #658b00">True</span>, stdin=PIPE).stdin
pipe.write(<span style="color: #CD5555">&#39;set xrange [0:10]; set yrange [-2:2]\n&#39;</span>)
pipe.write(<span style="color: #CD5555">&#39;plot sin(x)\n&#39;</span>)
pipe.write(<span style="color: #CD5555">&#39;quit&#39;</span>)  <span style="color: #228B22"># quit Gnuplot</span>
</pre></div>
<p>
Same as &quot;here documents&quot; in Unix shells:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">gnuplot &lt;&lt;EOF
<span style="color: #658b00">set</span> <span style="color: #658b00">xrange</span> [<span style="color: #B452CD">0</span>:<span style="color: #B452CD">10</span>]; <span style="color: #658b00">set</span> yrange [-<span style="color: #B452CD">2</span>:<span style="color: #B452CD">2</span>]
plot sin(x)
quit
EOF
</pre></div>
<p>

</section>


<section class="slide">

<h2>Find a program  <a name="___sec31"></a></h2>

Check if a given program is on the system:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">program = <span style="color: #CD5555">&#39;someprog&#39;</span>
path = os.environ[<span style="color: #CD5555">&#39;PATH&#39;</span>]
<span style="color: #228B22"># PATH can be /usr/bin:/usr/local/bin:/usr/X11/bin</span>
<span style="color: #228B22"># os.pathsep is the separator in PATH</span>
<span style="color: #228B22"># (: on Unix, ; on Windows)</span>
paths = path.split(os.pathsep)
<span style="color: #8B008B; font-weight: bold">for</span> d <span style="color: #8B008B">in</span> paths:
    <span style="color: #8B008B; font-weight: bold">if</span> os.path.isdir(d):
        <span style="color: #8B008B; font-weight: bold">if</span> os.path.isfile(os.path.join(d, program)):
             program_path = d; <span style="color: #8B008B; font-weight: bold">break</span>

<span style="color: #8B008B; font-weight: bold">try</span>:  <span style="color: #228B22"># program was found if program_path is defined</span>
    <span style="color: #8B008B; font-weight: bold">print</span> program, <span style="color: #CD5555">&#39;resides in&#39;</span>, program_path
<span style="color: #8B008B; font-weight: bold">except</span>:
    <span style="color: #8B008B; font-weight: bold">print</span> program, <span style="color: #CD5555">&#39;was not found&#39;</span>
</pre></div>
<p>
Corresponds to <code>which someprog</code> in Unix

<p>

</section>


<section class="slide">

<h2>Cross-platform fix of previous script  <a name="___sec32"></a></h2>

On Windows, programs usually end with <code>.exe</code> (binaries) or <code>.bat</code> (DOS scripts), while on Unix most programs have no extension

<p>
We test if we are on Windows:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">if</span> sys.platform[:<span style="color: #B452CD">3</span>] == <span style="color: #CD5555">&#39;win&#39;</span>:
    <span style="color: #228B22"># Windows-specific actions</span>
</pre></div>
<p>
Cross-platform snippet for finding a program:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">for</span> d <span style="color: #8B008B">in</span> paths:
    <span style="color: #8B008B; font-weight: bold">if</span> os.path.isdir(d):
        fullpath = os.path.join(<span style="color: #658b00">dir</span>, program)
        <span style="color: #8B008B; font-weight: bold">if</span> sys.platform[:<span style="color: #B452CD">3</span>] == <span style="color: #CD5555">&#39;win&#39;</span>:   <span style="color: #228B22"># windows machine?</span>
            <span style="color: #8B008B; font-weight: bold">for</span> ext <span style="color: #8B008B">in</span> <span style="color: #CD5555">&#39;.exe&#39;</span>, <span style="color: #CD5555">&#39;.bat&#39;</span>:  <span style="color: #228B22"># add extensions</span>
                <span style="color: #8B008B; font-weight: bold">if</span> os.path.isfile(fullpath + ext):
                    program_path = d; <span style="color: #8B008B; font-weight: bold">break</span>
        <span style="color: #8B008B; font-weight: bold">else</span>:
            <span style="color: #8B008B; font-weight: bold">if</span> os.path.isfile(fullpath):
                program_path = d; <span style="color: #8B008B; font-weight: bold">break</span>
</pre></div>
<p>

</section>


<section class="slide">

<h1>Simple text processing  <a name="___sec33"></a></h1>

<div class="alert alert-block alert-block alert-text-normal"><b style="font-weight: bold"></b>
When doing operating system tasks in Python, one often needs to
manipulate text and commands. The next slides list the basic
text processing tools in Python. More powerful tools are
accessible via regular expressions.
</div>


<p>

</section>


<section class="slide">

<h2>Splitting text  <a name="___sec34"></a></h2>

Split string into words:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; files = <span style="color: #CD5555">&#39;case1.png case2.png case3.png&#39;</span>
&gt;&gt;&gt; files.split()
[<span style="color: #CD5555">&#39;case1.png&#39;</span>, <span style="color: #CD5555">&#39;case2.png&#39;</span>, <span style="color: #CD5555">&#39;case3.png&#39;</span>]
</pre></div>
<p>
Can split wrt other characters:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; files = <span style="color: #CD5555">&#39;case1.png, case2.png, case3.png&#39;</span>
&gt;&gt;&gt; files.split(<span style="color: #CD5555">&#39;, &#39;</span>)
[<span style="color: #CD5555">&#39;case1.png&#39;</span>, <span style="color: #CD5555">&#39;case2.png&#39;</span>, <span style="color: #CD5555">&#39;case3.png&#39;</span>]
&gt;&gt;&gt; files.split(<span style="color: #CD5555">&#39;,  &#39;</span>)  <span style="color: #228B22"># extra erroneous space after comma...</span>
[<span style="color: #CD5555">&#39;case1.png, case2.png, case3.png&#39;</span>]  <span style="color: #228B22"># unintended split??</span>
</pre></div>
<p>
Very useful when interpreting text in files!

<p>

</section>


<section class="slide">

<h2>Example on using split to read data from file  <a name="___sec35"></a></h2>

Suppose you have file containing numbers only. The numbers appear
without any structure:

<p>

<!-- code=text (!bc dat) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">1.432 5E-09
1.0

3.2 5 69 -111
4 7 8
</pre></div>
<p>
It is easy to get a list of all these numbers:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">f = <span style="color: #658b00">open</span>(filename, <span style="color: #CD5555">&#39;r&#39;</span>)
numbers = [<span style="color: #658b00">float</span>(n) <span style="color: #8B008B; font-weight: bold">for</span> n <span style="color: #8B008B">in</span> f.read().split()]

<span style="color: #228B22"># or equivalently with map</span>
numbers = <span style="color: #658b00">map</span>(<span style="color: #658b00">float</span>, f.read().split())
</pre></div>
<p>

</section>


<section class="slide">

<h2>Joining a list of strings  <a name="___sec36"></a></h2>

Join is the opposite of split:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; filelist = [<span style="color: #CD5555">&#39;case1.png&#39;</span>, <span style="color: #CD5555">&#39;case2.png&#39;</span>, <span style="color: #CD5555">&#39;case3.png&#39;</span>]
&gt;&gt;&gt; text = <span style="color: #CD5555">&#39;, &#39;</span>.join(filelist)
&gt;&gt;&gt; text
<span style="color: #CD5555">&#39;case1.png, case2.png, case3.png&#39;</span>
</pre></div>
<p>
Any delimiter text can be used:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; <span style="color: #CD5555">&#39;@@@&#39;</span>.join(filelist)
<span style="color: #CD5555">&#39;case1.png@@@case2.png@@@case3.png&#39;</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>Common use of join/split  <a name="___sec37"></a></h2>


<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #228B22"># Read file into a string</span>
f = <span style="color: #658b00">open</span>(<span style="color: #CD5555">&#39;myfile&#39;</span>, <span style="color: #CD5555">&#39;r&#39;</span>)
filestr = <span style="color: #658b00">file</span>.read()
f.close()

filestr = filestr.replace(<span style="color: #CD5555">&#39;directory&#39;</span>, <span style="color: #CD5555">&#39;folder&#39;</span>)

<span style="color: #228B22"># convert back to list of lines and process lines</span>
lines = filestr.splitlines()
<span style="color: #8B008B; font-weight: bold">for</span> i, line <span style="color: #8B008B">in</span> <span style="color: #658b00">enumerate</span>(lines):
    <span style="color: #228B22"># if line starts with &gt;&gt;&gt; and previous line is not empty,</span>
    <span style="color: #228B22"># remove the leading &gt;&gt;&gt;</span>
    <span style="color: #8B008B; font-weight: bold">if</span> line.startswith(<span style="color: #CD5555">&#39;&gt;&gt;&gt;&#39;</span>) <span style="color: #8B008B">and</span> i&gt;<span style="color: #B452CD">0</span> \
       <span style="color: #8B008B">and</span> <span style="color: #8B008B">not</span> lines[i-<span style="color: #B452CD">1</span>].strip() == <span style="color: #CD5555">&#39;&#39;</span>:
        lines[i] = lines[i][<span style="color: #B452CD">3</span>:]  <span style="color: #228B22"># strip off &gt;&gt;&gt;</span>

filestr = <span style="color: #CD5555">&#39;\n&#39;</span>.join(lines)  <span style="color: #228B22"># make a string again</span>

f = <span style="color: #658b00">open</span>(<span style="color: #CD5555">&#39;myfile.new&#39;</span>, <span style="color: #CD5555">&#39;w&#39;</span>)
f.write(filestr)
f.close()
</pre></div>
<p>

</section>


<section class="slide">

<h2>Searching in strings  <a name="___sec38"></a></h2>

Exact word match:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">if</span> <span style="color: #CD5555">&#39;somestring&#39;</span> <span style="color: #8B008B">in</span> line

<span style="color: #8B008B; font-weight: bold">if</span> line == <span style="color: #CD5555">&#39;somestring&#39;</span>:
   <span style="color: #228B22"># line equals &#39;somestring&#39;</span>
</pre></div>
<p>
Matching with Unix shell-style wildcard notation:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">&gt;&gt;&gt; <span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">fnmatch</span>
&gt;&gt;&gt; filename = <span style="color: #CD5555">&#39;package-python-sympy.txt&#39;</span>
&gt;&gt;&gt; wildcard_pattern = <span style="color: #CD5555">&#39;*-python-*.t*xt&#39;</span>
&gt;&gt;&gt; fnmatch.fnmatch(filename, wildcard_pattern)
<span style="color: #658b00">True</span>
&gt;&gt;&gt; filename = <span style="color: #CD5555">&#39;package-python-sympy.text&#39;</span>
&gt;&gt;&gt; fnmatch.fnmatch(filename, wildcard_pattern)
<span style="color: #658b00">True</span>
&gt;&gt;&gt; filename = <span style="color: #CD5555">&#39;package-python-sympy&#39;</span>
&gt;&gt;&gt; fnmatch.fnmatch(filename, wildcard_pattern)
<span style="color: #658b00">False</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>Searching in strings with regular expressions  <a name="___sec39"></a></h2>

Matching with full regular expressions:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">re</span>

<span style="color: #8B008B; font-weight: bold">if</span> re.search(<span style="color: #CD5555">r&#39;somestring&#39;</span>, line):
    <span style="color: #228B22"># line contains &#39;somestring&#39;</span>

<span style="color: #8B008B; font-weight: bold">if</span> re.search(<span style="color: #CD5555">r&#39;^somestring$&#39;</span>, line):
    <span style="color: #228B22"># line equals &#39;somestring&#39;</span>

pattern = <span style="color: #CD5555">&#39;.*-python-.*\.t.*xt&#39;</span>
<span style="color: #8B008B; font-weight: bold">if</span> re.search(pattern, line):
    <span style="color: #228B22"># line contains some text of the form specified by pattern</span>
</pre></div>
<p>

</section>


<section class="slide">

<h2>Substitution  <a name="___sec40"></a></h2>

Simple substitution:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">newstring = oldstring.replace(substring, newsubstring)
</pre></div>
<p>
Substitute regular expression
<code>pattern</code> by <code>replacement</code> in <code>str</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">re</span>
<span style="color: #658b00">str</span> = re.sub(pattern, replacement, <span style="color: #658b00">str</span>)
</pre></div>
<p>

</section>


<section class="slide">

<h2>Brief summary  <a name="___sec41"></a></h2>

<ul>
  <p><li> Typical Unix shell tasks can also be done using Python in a cross-platform
    fashion so it works on Mac, Windows, and Linux</li>
  <p><li> Key Python modules for shell operations; <code>os</code>, <code>shutil</code>, <code>glob</code>, <code>tarfile</code>, <code>subprocess</code></li>
  <p><li> Python has numerous tools for text processing:</li>

<ul>
    <p><li> <code>join</code> and <code>split</code></li>
    <p><li> <code>fnmatch</code> for Unix wildcard matching</li>
    <p><li> regular expressions</li>
</ul>
<p>

</ul>
<p>



</section>




<footer>
<!-- Here goes a footer -->
</footer>

<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>
-->

<!-- deck.goto snippet
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>
-->

<!-- deck.hash snippet
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>
-->

<!-- End extension snippets. -->


<!-- Required JS files. -->
<script src="deck.js/jquery.min.js"></script>
<script src="deck.js/core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="deck.js/core/deck.core.js"></script>
<script src="deck.js/extensions/hash/deck.hash.js"></script>
<script src="deck.js/extensions/menu/deck.menu.js"></script>
<script src="deck.js/extensions/goto/deck.goto.js"></script>
<script src="deck.js/extensions/status/deck.status.js"></script>
<script src="deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="deck.js/extensions/scale/deck.scale.js"></script>
<script src="deck.js/extensions/notes/deck.notes.js"></script>

<!-- From https://github.com/mikeharris100/deck.pointer.js -->
<script src="deck.js/extensions/pointer/deck.pointer.js"></script>

<!-- From https://github.com/stvnwrgs/presenterview
<script type="text/javascript" src="deck.js/extensions/presenterview/deck.presenterview.js"></script> -->

<!-- From https://github.com/nemec/deck.annotate.js
<script type="text/javascript" src="deck.js/extensions/deck.annotate.js/deck.annotate.js"></script>
-->


<!-- Initialize the deck. You can put this in an external file if desired. -->
<script>
	$(function() {
		$.deck('.slide');
	});
</script>


</body>
</html>
