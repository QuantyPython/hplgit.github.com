<?xml version="1.0" encoding="utf-8" ?>
<!--
Automatically generated HTML file from Doconce source
(http://code.google.com/p/doconce/)
-->

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Doconce: http://code.google.com/p/doconce/" />
</head>

<body bgcolor="white">
    <title>How To Generate API Documentation with Sphinx</title>
<center><h1>How To Generate API Documentation with Sphinx</h1></center>
<center>
<b>Hans Petter Langtangen</b> [1, 2]
</center>

<p>
<center>[1] <b>Simula Research Laboratory</b></center>
<center>[2] <b>University of Oslo</b></center>


<center><h3>May 2, 2012</h3></center>
<P>

<P>

<P>
The current standard tool for documenting Python software is
Sphinx. This tool was created to support hand-written documentation
files in the reStructuredText (reST) format, but Sphinx also supports
automatic generation of module or package documentation based on
parsing function headers and extracting doc strings. We refer to such
documentation as <em>API documentation</em>. For an example, see the
documentation of the <tt>numpy.polyfit</tt> function
<a href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.polyfit.html"><tt>http://docs.scipy.org/doc/numpy/reference/generated/numpy.polyfit.html</tt></a>.

<P>
There are two principal steps in making API documentation. First, write
doc strings in all key classes, methods, and functions using the
formatting described below. Second, copy the script
<a href="src-sphinx_api/make.py">make.py</a> (<a href="_static/make.py.html">view</a>)
to the directory where you have the source code, adapt the script by
changing a few lines in the top of it, and run the code
to generate the documentation (in the <tt>API</tt>
subdirectory).  The script automates the various steps in running
Sphinx and preparing Sphinx files as described later.

<P>
We shall now briefly describe the reST format and show step by step
how to create API documentation of Python modules.
We follow the documentation <a href="https://github.com/numpy/numpy/blob/master/doc/example.py">rules</a> of the
<tt>numpy</tt> package. Sphinx version 1.1 or higher is then required.  In
addition, the <tt>numpydoc</tt> Sphinx extension must be installed.  Download
the <tt>numpy</tt> source tree, go to the top directory and perform
<blockquote>    <!-- begin verbatim block  -->
<pre>
cd doc/sphinxext
sudo python setup.py install
</pre>
</blockquote>   <! -- end verbatim block -->

<P>
<h3>Simple Formatting Rules</h3>
<P>
The reST format used by Sphinx and other popular tools in the Python
community is a lightly tagged markup language, much less tagged than
LaTeX and HTML. There is a
<a href="http://docutils.sourceforge.net/docs/user/rst/quickstart.html">Quick Start Guide</a>
for reST that gives a much broader overview than the brief
description below. The
Sphinx <a href="http://docutils.sourceforge.net/docs/user/rst/quickref.html">Quick Reference</a> is also handy.

<P>
Paragraphs are separated by blank lines. Words in running
text can be <em>emphasized</em>.  Furthermore, text in double backquotes
is typeset as code: <tt>s = sin(r)</tt>.  Bullet lists start with
a dash (-) and are indented, with a blank line before and after:
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
  * a is the first parameter.

  * b is the second parameter. An item can
    occupy multiple lines.

  * c is the third parameter.
</pre>
</blockquote>   <! -- end verbatim block -->
In description lists, where each item starts with a keyword, an item
starts with the keyword, followed by a colon, and the text appears
indented on the next line:
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
  a:
    the first parameter

  b:
    the second parameter. An item can
    occupy multiple
    lines.

  c:
    the third parameter.
</pre>
</blockquote>   <! -- end verbatim block -->

<P>
To make a section heading, just write the heading and use equal signs, on
the line below the heading, for sections, and simple dashes for
subsections (other choices of characters are also possible).

<P>

<P>
<h4>Mathematics</h4>
<P>
Mathematical formulas are typeset in LaTeX style inline. For example,
ax^2 + bx + c is written like
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
:math:`ax^2 + bx + c`
</pre>
</blockquote>   <! -- end verbatim block -->
Two write an equation on a separate line,
write
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
`.. math:: ax^2 + bx + c = 0
</pre>
</blockquote>   <! -- end verbatim block -->
or
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
.. math::

   ax^2 + bx + c = 0

</pre>
</blockquote>   <! -- end verbatim block -->
Remember to end the equation block with a blank line.
Several equations can be aligned below each other by using <tt>&</tt>
as alignment character:
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
.. math::

   ax^2 + bx + c &= 0,\\
   dx + e &= 0.

</pre>
</blockquote>   <! -- end verbatim block -->

<P>
<h4>Code Snippets</h4>
<P>
To include a piece of code like
<blockquote>    <!-- begin verbatim block   pycod-->
<pre>
def roots(a, b, c):
    q = b**2 - 4*a*c
    root1 = (-b + sqrt(q))/float(2*a)
    root2 = (-b - sqrt(q))/float(2*a)
    return root1, root2
</pre>
</blockquote>   <! -- end verbatim block -->
you can write it as
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
Here is an example::

        def roots(a, b, c):
            q = b**2 - 4*a*c
            root1 = -b + sqrt(q)/float(2*a)
            root2 = -b - sqrt(q)/float(2*a)
            return root1, root2
</pre>
</blockquote>   <! -- end verbatim block -->
The code block must be intented, and the preceding line must end with
a double colon. To specify the type of programming language and
associated formatting (via the Pygments package), write
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
.. code-block:: python

        def roots(a, b, c):
            q = b**2 - 4*a*c
            root1 = -b + sqrt(q)/float(2*a)
            root2 = -b - sqrt(q)/float(2*a)
            return root1, root2
</pre>
</blockquote>   <! -- end verbatim block -->

<P>
Interactive sessions and doctests can be inserted without
colon and indentation of the code, but a blank line is
needed before and after the interactive block.
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
Here is an example in an interactive Python shell.

&gt;&gt;&gt; a = 1
&gt;&gt;&gt; b = 2
&gt;&gt;&gt; a + b
3

Note: the result is correct.
</pre>
</blockquote>   <! -- end verbatim block -->

<P>
<h4>How to Format Doc Strings</h4>
<P>
Here is a function with a typical doc string formatted in <tt>numpy</tt> style.
<blockquote>    <!-- begin verbatim block  -->
<pre>
# This is Python code
from numpy.lib.scimath import sqrt  # handles real and complex args

def roots(a, b, c, verbose=False):
    """
    Return the two roots in the quadratic equation::

      a*x**2 + b*x + c = 0

    or written with math typesetting

    .. math:: ax^2 + bx + c = 0

    The returned roots are real or complex numbers,
    depending on the values of the arguments `a`, `b`,
    and `c`.

    Parameters
    ----------
    a: int, real, complex
       coefficient of the quadratic term
    b: int, real, complex
       coefficient of the linear term
    c: int, real, complex
       coefficient of the constant term
    verbose: bool, optional
       prints the quantity ``b**2 - 4*a*c`` and if the
       roots are real or complex

    Returns
    -------
    root1, root2: real, complex
        the roots of the quadratic polynomial.

    Raises
    ------
    ValueError:
        when `a` is zero

    See Also
    --------
    :class:`Quadratic`: which is a class for quadratic polynomials
        that also has a :func:`Quadratic.roots` method for computing
        the roots of a quadratic polynomial. There is also a class
        :class:`~linear.Linear` in the module :mod:`linear`
        (i.e., :class:`linear.Linear`).

    Notes
    -----
    The algorithm is a straightforward implementation of
    a very well known formula [1]_.

    References
    ----------
    .. [1] Any textbook on mathematics or
           `Wikipedia &lt;http://en.wikipedia.org/wiki/Quadratic_equation&gt;`_.

    Examples
    --------
    &gt;&gt;&gt; roots(-1, 2, 10)
    (-5.3166247903553998, 1.3166247903553998)
    &gt;&gt;&gt; roots(-1, 2, -10)
    ((-2-3j), (-2+3j))

    Alternatively, we can in a doc string list the arguments and
    return values in a table

    ==========   =============   ================================
    Parameter    Type            Description
    ==========   =============   ================================
    a            float/complex   coefficient for quadratic term
    b            float/complex   coefficient for linear term
    c            float/complex   coefficient for constant term
    r1, r2       float/complex   return: the two roots of
                                 the quadratic polynomial
    ==========   =============   ================================
    """
    if abs(a) &lt; 1E-14:
        raise ValueError('a=%g is too close to zero' % a)

    q = b**2 - 4*a*c
    if verbose:
        print 'q=%g: %s roots' % (q, 'real' if q&gt;0 else 'complex')

    root1 = (-b + sqrt(q))/float(2*a)
    root2 = (-b - sqrt(q))/float(2*a)
    return root1, root2
</pre>
</blockquote>   <! -- end verbatim block -->
Note the following:

<P>

<ol>
<li> Arguments to the functions and other variables are typeset in
   single back-ticks (normally translated to an italic font by Sphinx).
<li> The headings <tt>Parameters</tt> (for function arguments), <tt>Returns</tt>, etc.,
   are standard names and lead to a certain formatting of the doc
   string in HTML. The text following these headings are description
   lists. Sometimes a simpler formatting is convenient,
   e.g., a table or just running text explaining what the arguments and
   return values are.
<li> One can make links to the documentation of other classes and functions
   as demonstrated under "See Also" (a tilde strips off the
   module prefix in the output).
</ol>
<h3>Running Sphinx</h3>
<P>
We have made a complete example on
making API documentation with Sphinx.
The module files <a href="src-sphinx_api/quadratic.py">quadratic.py</a>
(<a href="_static/quadratic.py.html">view</a>) and
<a href="src-sphinx_api/linear.py">linear.py</a> (<a href="_static/linear.py.html">view</a>)
contain examples of classes and a stand-alone functions with
doc strings formatted as described above.
The file <a href="src-sphinx_api/make.py">make.py</a>
(<a href="_static/make.py.html">view</a>) runs
(automatically) all the steps described below and creates
<a href="_static/api-example/index.html">HTML documentation</a>
of the two modules.

<P>
<h4>Make Sphinx Module Files</h4>
<P>
For each module file <tt>module.py</tt> you want include in the documentation,
prepare a file <tt>module.txt</tt> containing
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
  :mod:`module`
  =============

  .. automodule:: module
     :members:
     :undoc-members:
     :special-members:
     :inherited-members:
     :show-inheritance:
</pre>
</blockquote>   <! -- end verbatim block -->
This specifications imply that the documentation will contain
all member functions (not starting with an underscore) with doc strings
(<tt>:members:</tt>), and those without
doc strings (<tt>:undoc-members:</tt>), as well as all special methods
(<tt>:special-members:</tt>), and all methods inherited from super classes
(<tt>:inherited-members:</tt>).
For the worked example we need to make the module files
<a href="src-sphinx_api/api/quadratic.txt"><tt>src-sphinx_api/api/quadratic.txt</tt></a> (<a href="_static/quadratic.txt.html">view</a>)
and <a href="src-sphinx_api/api/linear.txt"><tt>src-sphinx_api/api/linear.txt</tt></a> (<a href="_static/linear.txt.html">view</a>).

<P>
The name of modules in a subpackages must be listed with the full package path.
For example, module <tt>mod</tt> in subpackage <tt>s2</tt> of subpackage <tt>s1</tt> is listed as
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
:mod:`s1.s2.mod`
================

.. automodule:: s1.s2.mod
</pre>
</blockquote>   <! -- end verbatim block -->
in the file <tt>mod.txt</tt>. The <tt>index.txt</tt> file has a corresponding line
with <tt>mod</tt> (which actually is the basename of the file <tt>mod.txt</tt>
where the module <tt>s1.s2.mod</tt> is defined).
For each of the <tt>__init__.py</tt> files in the packages one will normally
make a <tt>.txt</tt> file with the package name, say <tt>s2.txt</tt>, where the first
lines are:
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
:mod:`s1.s2`
============

.. automodule:: s1.s2
</pre>
</blockquote>   <! -- end verbatim block -->

<P>

<P>

<P>
<h4>Create Sphinx Directory Tree</h4>
<P>
Sphinx needs a series of files that can be automatically
generated by running
<blockquote>    <!-- begin verbatim block   sys-->
<pre>
sphinx-quickstart
</pre>
</blockquote>   <! -- end verbatim block -->
and answering the questions. Specify a directory name as
"rooth path for the documentation", say <tt>api</tt>, give the
documentation a title, author, and version number.
Make sure the extension of sphinx files is
<tt>.txt</tt> and not <tt>.rst</tt>. If you make a fresh version of the
documentation, remember to first delete the <tt>api</tt> directory.
Move all the <tt>module.txt</tt> files to the <tt>api</tt> directory.

<P>
<h4>Make Index File</h4>
<P>
In the recently generated <tt>api</tt> directory,
you must make an index file <tt>index.txt</tt> that lists the modules for
which there exist <tt>.txt</tt> files . The <tt>index.txt</tt> file is automatically
generated by <tt>sphinx-quickstart</tt>, but no modules are listed.
Here is the typical look when it contains two modules <tt>quadratic</tt>
and <tt>linear</tt>:
<blockquote>    <!-- begin verbatim block   rst-->
<pre>
.. Docex Example documentation master file, created by
   sphinx-quickstart on Thu Feb 16 10:50:28 2022.
   ...

Welcome to Sphinx API Example's documentation!
==============================================

Contents:

.. toctree::
   :maxdepth: 2

   quadratic
   linear

Indices and tables
==================

* :ref:`genindex`
* :ref:`modindex`
* :ref:`search`
</pre>
</blockquote>   <! -- end verbatim block -->
Recall that each module listed in this file
must have a corresponding <tt>.txt</tt> file as
described above.

<P>
<h4>Edit the Configuration File</h4>
<P>
The <tt>api</tt> directory contains a file <tt>conf.py</tt> which allows you
to configure a lot of features. You need to find the
line with
<blockquote>    <!-- begin verbatim block   pycod-->
<pre>
#sys.path.insert(0, os.path.abspath('.'))
</pre>
</blockquote>   <! -- end verbatim block -->
Uncomment this line and insert the directory where the modules reside,
in this case the parent directory
<blockquote>    <!-- begin verbatim block   pycod-->
<pre>
sys.path.append(os.path.join(os.path.abspath(os.pardir)))
</pre>
</blockquote>   <! -- end verbatim block -->
We also recommend to make use of more Sphinx extension modules.
Find the line with <tt>extensions =</tt> and edit it to
<blockquote>    <!-- begin verbatim block   cod-->
<pre>
extensions = [
    'sphinx.ext.autodoc',
    'sphinx.ext.mathjax',
    'sphinx.ext.viewcode',
    'numpydoc',
    'sphinx.ext.autosummary',
    'sphinx.ext.doctest',
    'sphinx.ext.inheritance_diagram']
</pre>
</blockquote>   <! -- end verbatim block -->
If not the <tt>numpydoc</tt> Sphinx extension is enabled, headings like
<tt>Parameters</tt>, <tt>Returns</tt>, etc., are ignored and give rise to
error messages ("Unexpected section title").

<P>
You may also want to add
<blockquote>    <!-- begin verbatim block   cod-->
<pre>
extensions += [
    'matplotlib.sphinxext.only_directives',
    'matplotlib.sphinxext.plot_directive',
    'matplotlib.sphinxext.ipython_directive',
    'matplotlib.sphinxext.ipython_console_highlighting']
</pre>
</blockquote>   <! -- end verbatim block -->
if <tt>matplotlib</tt> is installed.

<P>

<P>
<h4>Compile the Sphinx Document</h4>
<P>
You are now ready to compile an HTML version of the Sphinx documentation:
<blockquote>    <!-- begin verbatim block   sys-->
<pre>
make html
</pre>
</blockquote>   <! -- end verbatim block -->
This command results in a directory <tt>_build/html</tt> with a
file <tt>index.html</tt> that can be loaded into a web browser for inspection.

<P>
The Python script
<a href="src-sphinx_api/make.py">make.py</a> (<a href="_static/make.py.html">view</a>)
automatically generates <tt>.txt</tt> index files for each <tt>.py</tt> file,
runs <tt>sphinx-quickstart</tt>, copies index files to the new generated directory,
edits <tt>conf.py</tt>, and runs <tt>make html</tt> to create the API documentation
in HTML format. Examining the <tt>make.py</tt> script provides a complete
recipe for getting started with Sphinx for automatically generating
module and package documentation. The script can easily be applied
to your own projects (it works without modifications if you want to
document all <tt>.py</tt> files in a directory).
in a directory)

<P>
To see the result of the generated documentation,
invoke <a href="_static/api-example/index.html"><tt>api/_build/html/index.html</tt></a>.
Click around to see the various features, like the index, for instance.
The layout and colors can be customized through different
Sphinx <em>themes</em>, see the <tt>api/conf.py</tt> file. Several examples
are provided in
the <a href="_static/examples/index.html">examples directory</a>.

<P>
Our example with the <tt>quadratic</tt> and <tt>linear</tt> modules is minimalistic.
An excellent large-scale example on documenting a packing using Sphinx
is found in the Matplotlib source (subdirectory <tt>doc</tt>).  SciTools also
applies Sphinx for documentation, and the file
<tt>doc/api/sphinx-src/00README</tt> in the SciTools source tree explains the
necessary steps in detail. Before diving into the documentation
details of Matplotlib or SciTools, it will be advantageous to have
digested some of the official Sphinx documentation, reached from
<a href="http://sphinx.pocoo.org/"><tt>http://sphinx.pocoo.org/</tt></a>.

<P>

<P>
<center><hr>
<caption><i>Snapshot of HTML documentation automatically generated by Sphinx. <a name="sphinx_api:fig:html"></A></i></caption>
<p><img src="figs-sphinx_api/sphinx.png" align="bottom" width=600></p>
</center>

<P>
<h3>Doconce Doc String Format</h3>
<P>
A disadvantage with the Sphinx format in doc strings is that it has
quite some tagging that can be annoying when reading the doc strings
directly, as done when invoking <tt>pydoc</tt> on the command line or
<tt>help(...)</tt> or <tt>object.__doc__</tt> in interactive Python sessions.
By writing the doc strings in <a href="http://code.google.com/p/doconce">Doconce</a>
format, one can transform the text both to Sphinx and to plain ASCII.
That is, the doc strings looks nice in <tt>pydoc</tt> and in HTML.

</body>
</html>
    