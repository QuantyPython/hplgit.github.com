
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>A Worked Example on Scientific Computing with Python &mdash; A Worked Example on Scientific Computing with Python: Vehicle on Bumpy Road 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="A Worked Example on Scientific Computing with Python: Vehicle on Bumpy Road 1.0 documentation" href="index.html" />
    <link rel="prev" title="A Worked Example on Scientific Computing with Python: Vehicle on Bumpy Road" href="index.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="index.html" title="A Worked Example on Scientific Computing with Python: Vehicle on Bumpy Road"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">A Worked Example on Scientific Computing with Python: Vehicle on Bumpy Road 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="a-worked-example-on-scientific-computing-with-python">
<h1>A Worked Example on Scientific Computing with Python<a class="headerlink" href="#a-worked-example-on-scientific-computing-with-python" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Hans Petter Langtangen</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">Aug 30, 2012</td>
</tr>
</tbody>
</table>
<p>This worked example</p>
<blockquote>
<div><ul class="simple">
<li>fetches a data file from a web site,</li>
<li>applies that file as input data for a differential equation modeling a vibrating system,</li>
<li>solves the equation,</li>
<li>visualizes various properties of the solution and the input data.</li>
</ul>
</div></blockquote>
<p>The following programming topics are illustrated:</p>
<blockquote>
<div><ul class="simple">
<li>downloading files from a web site,</li>
<li>working with <tt class="docutils literal"><span class="pre">numpy</span></tt> arrays,</li>
<li>flexible storage of objects in lists,</li>
<li>easy storage of objects in files (persistence),</li>
<li>signal processing and FFT,</li>
<li>curve plotting of data.</li>
</ul>
</div></blockquote>
<p>Required backround:</p>
<blockquote>
<div><ul class="simple">
<li>some interest in exploring physics through numerical simulation</li>
<li>some very basic knowledge of differential equations</li>
<li>some very basic knowledge of finite difference approximations</li>
<li>significant interest in exploring Python for scientific computations</li>
</ul>
</div></blockquote>
<p><em>No background in Python is assumed - the aim is to give an impression of
how Python can be used in a MATLAB-like fashion to solve a real-world
physical problem (with low mathematical complexity).</em></p>
<p>Alternative tutorials for scientific programming with Python:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://physics.nyu.edu/pine/pymanual/">PyPrimer</a></li>
<li><a class="reference external" href="http://fperez.org/py4science/starter_kit.html">Useful software</a></li>
<li><a class="reference external" href="http://fperez.org/py4science/warts.html">Why Python for Scientific Computing?</a></li>
<li><a class="reference external" href="http://www.scipy.org/Tentative_NumPy_Tutorial">NumPy Tutorial</a></li>
<li><a class="reference external" href="http://docs.scipy.org/doc/numpy/user/">NumPy User Guide</a></li>
<li><a class="reference external" href="https://github.com/pv/advanced-numpy-tutorial">Advanced NumPy Tutorial</a></li>
<li><a class="reference external" href="http://scipy2010.blogspot.com/2010/06/tutorials-day-1-advanced-numpy.html">Advanced NumPy Course</a></li>
<li><a class="reference external" href="http://www.scipy.org/Numpy_Example_List">NumPy Example List</a></li>
<li><a class="reference external" href="http://mentat.za.net/numpy/numpy_advanced_slides/">NumPy Medkit</a></li>
<li><a class="reference external" href="http://www.scipy.org/Cookbook">NumPy and SciPy Cookbook</a></li>
<li><a class="reference external" href="http://www.scipy.org/NumPy_for_Matlab_Users">NumPy for Matlab Users</a></li>
<li><a class="reference external" href="http://mathesaurus.sf.net">NumPy for Matlab/R/IDL Users</a></li>
<li><a class="reference external" href="http://web.phys.ntnu.no/~ingves/Teaching/TFY4240/Assignments/PythonScientific.pdf">Python Scientific</a> (lecture notes)</li>
<li><a class="reference external" href="http://www.maths.lth.se/na/help/media/Practical_Scientific_Computing_with_Python.pdf">Practical Scientific Computing with Python</a></li>
<li><a class="reference external" href="http://www.astropython.org/tutorial/2011/8/Python-Scientific-Lecture-Notes">AstroPython</a></li>
<li><a class="reference external" href="http://ipython.scipy.org/doc/manual/html">IPython</a></li>
<li><a class="reference external" href="http://code.google.com/p/pythonxy/wiki/Welcome">Python(x,y)</a></li>
</ul>
</div></blockquote>
<div class="section" id="physical-problem">
<h2>Physical Problem<a class="headerlink" href="#physical-problem" title="Permalink to this headline">¶</a></h2>
<p>The task is to make a simulation program that can predict how a (simple)
mechanical system oscillates in response to environmental forces.
Introducing <span class="math">\(u(t)\)</span> as some displacement of the system at time <span class="math">\(t\)</span>,
application of Newton&#8217;s second law of motion to such a mechanical system often
results in the following type of equation for <span class="math">\(u\)</span>:</p>
<div class="math" id="equation-bumpy:eq1">
<span class="eqno">(1)</span>\[     mu''(t) + bu'(t) + f(u) = F(t),\]</div>
<p>The prime, as in <span class="math">\(u'(t)\)</span>, denotes differentiation with respect to time.
Furthermore, <span class="math">\(m\)</span> is the mass of the system, <span class="math">\(b\)</span> is a coefficient related to
the damping of the system, <span class="math">\(f(u)\)</span> represents a restoring force, such as
a spring, and <span class="math">\(F(t)\)</span> are the external environmental forces on the system.
Equation <a href="#equation-bumpy:eq1">(1)</a> must be accompanied by two initial conditions
for <span class="math">\(u(0)\)</span> and <span class="math">\(u'(0)\)</span>.
The values of these have no effect on the
steady state behavior of <span class="math">\(u(t)\)</span> for large values of <span class="math">\(t\)</span>, since this
behavior is determined by the force <span class="math">\(F(t)\)</span> and the system
parameters <span class="math">\(m\)</span>, <span class="math">\(b\)</span>, and <span class="math">\(f(u)\)</span>. Therefore, we simply choose
<span class="math">\(u(0)=I\)</span> and <span class="math">\(u'(0)=0\)</span>.
The input data consists of <span class="math">\(m\)</span>, <span class="math">\(b\)</span>, <span class="math">\(f(u)\)</span>, <span class="math">\(F(t)\)</span>,
<span class="math">\(u(0)\)</span>, and <span class="math">\(u'(0)\)</span>, while the <span class="math">\(u(t)\)</span> is the unknown quantity to be
computed.</p>
<p>One example where the model above has relevance, is the vertical
vibration of a vehicle in response to a bumpy road. Let <span class="math">\(h(x)\)</span> be the
height of the road at some coordinate <span class="math">\(x\)</span> along the road.  When
driving along this road with constant velocity <span class="math">\(v\)</span>, the vehicle is
moved up and down in time according to <span class="math">\(h(vt)\)</span>, resulting in an
external vertical force <span class="math">\(F(t)=-mh''(vt)v^2\)</span>. We assume that the
vehicle has springs and dampers that here are modeled as <span class="math">\(bu'\)</span>
(damper) and <span class="math">\(f(s)=ku\)</span> (spring), with given damping parameter <span class="math">\(b\)</span> and
spring constant <span class="math">\(k\)</span>. The unknown <span class="math">\(u(t)\)</span> is the vertical displacement
of the vehicle relative to the road. Figure <a class="reference internal" href="#bumpy-fig1"><em>Vehicle on a bumpy road</em></a>
illustrates the situation.</p>
<div class="figure" id="bumpy-fig1">
<img alt="_images/vehicle2.png" src="_images/vehicle2.png" style="width: 600px;" />
<p class="caption"><em>Vehicle on a bumpy road</em></p>
</div>
<p>Another example regards the vertical shaking of a building due to
earthquake-induced movement of the ground. If the vertical displacement of the
ground is recorded as a function <span class="math">\(d(t)\)</span>, this results in a
vertical force <span class="math">\(F(t)=-md''(t)\)</span>. The soil foundation acts as a
spring and damper on the building, modeled through the damping parameter
<span class="math">\(b\)</span> and normally a linear spring term <span class="math">\(f(u)=ku\)</span>.</p>
<p>In both cases we drop the effect of gravity, which is just a constant
compression of the spring.</p>
<p>Our task is to compute and analyse the vertical <span class="math">\(u(t)\)</span> vibrations
of a vehicle, given the shape <span class="math">\(h(x)\)</span> of the road and some velocity <span class="math">\(v\)</span>.</p>
</div>
<div class="section" id="numerical-model-and-implementation">
<h2>Numerical Model and Implementation<a class="headerlink" href="#numerical-model-and-implementation" title="Permalink to this headline">¶</a></h2>
<p>Using a standard second-order finite difference method for <a href="#equation-bumpy:eq1">(1)</a>
gives rise to an algorithm that computes an approximation <span class="math">\(u^n\)</span> to
<span class="math">\(u(t_n)\)</span> at time points <span class="math">\(t_n=n\Delta t\)</span>, <span class="math">\(n=1,2,\ldots\)</span>, where <span class="math">\(\Delta t\)</span>
is a (small) time interval. For example, if <span class="math">\(\Delta t = 0.1\)</span>, we
find approximations <span class="math">\(u^1\)</span> to <span class="math">\(u\)</span> at <span class="math">\(t=0.1\)</span>, <span class="math">\(u^2\)</span> at <span class="math">\(t=0.2\)</span>, <span class="math">\(u^3\)</span>
to <span class="math">\(t=0.3\)</span>, and so forth. Mathematically, the algorithm can be
written as</p>
<div class="math">
\[\begin{split}u^0 &amp;= 0,\\
u^1 &amp;= u^0 - \frac{\Delta t^2}{2m}\left( f(u^0) - F(t_0)\right),\\
u^n &amp;= \left(
\left(\frac{1}{2}b\Delta t - m\right)u^{n-1} + 2mu^n - \Delta t^2\left(
f(u^n) - F(t_n)\right)\right)\left(\frac{1}{2}b\Delta t + m\right)^{-1},\
n=2,3,\ldots\end{split}\]</div>
<p>The implementation of the computational algorithm can make use
of an array <tt class="docutils literal"><span class="pre">u</span></tt> to represent <span class="math">\(u^n\)</span> as <tt class="docutils literal"><span class="pre">u[n]</span></tt>. The force <span class="math">\(F(t_n)\)</span> is
assumed to be available as an array element <tt class="docutils literal"><span class="pre">F[n]</span></tt>. The following
Python function computes <tt class="docutils literal"><span class="pre">u</span></tt> given  an array <tt class="docutils literal"><span class="pre">t</span></tt>
with time points <span class="math">\(t_0,t_1,\ldots\)</span>,
the initial displacement <tt class="docutils literal"><span class="pre">I</span></tt>, mass <tt class="docutils literal"><span class="pre">m</span></tt>, damping parameter <tt class="docutils literal"><span class="pre">b</span></tt>,
restoring force <tt class="docutils literal"><span class="pre">f(u)</span></tt>, environmental forces <tt class="docutils literal"><span class="pre">F</span></tt> as an array
(corresponding to <tt class="docutils literal"><span class="pre">t</span></tt>).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">forced_vibrations</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve a vibrating system problem m*u&#39;&#39; + b*u&#39; + f(u) = F(t)</span>
<span class="sd">    with u(0)=I and u&#39;(0)=0, for time values in the array t,</span>
<span class="sd">    by a finite difference method. Return u.</span>
<span class="sd">    u is an array of the same size as the array F and t.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>           <span class="c"># time step</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>             <span class="c"># no of time intervals</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> \
                  <span class="o">-</span> <span class="n">dt</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="o">-</span> <span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
<div class="section" id="dissection-of-the-code">
<h3>Dissection of the Code<a class="headerlink" href="#dissection-of-the-code" title="Permalink to this headline">¶</a></h3>
<p>Functions in Python start with <tt class="docutils literal"><span class="pre">def</span></tt>, followed by the function name and
the list of input objects separated by comma. The function body is
indented, and the first non-indented line signifies the end of the function
body block. The string, enclosed in triple double-quotes, right after
the function definition, is a <em>doc string</em> used for documenting the
function. Various tools can extract function definitions and doc strings
to automatically produced manuals.</p>
<p>Array functionality is offered by
the <tt class="docutils literal"><span class="pre">numpy</span></tt> packaged, here imported under the nickname <tt class="docutils literal"><span class="pre">np</span></tt>.
This package contains MATLAB-like functionality. It is quite common
to prefix a MATLAB-like function such as <tt class="docutils literal"><span class="pre">zeros</span></tt> by <tt class="docutils literal"><span class="pre">np</span></tt> (<tt class="docutils literal"><span class="pre">np.zeros</span></tt>),
but one can also perform</p>
<div class="highlight-py"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>and then write just <tt class="docutils literal"><span class="pre">zeros</span></tt> without any prefix. The advantage is that
the code closely  resembles similar MATLAB code.</p>
<p>The total number of elements in an array <tt class="docutils literal"><span class="pre">t</span></tt> is obtained by <tt class="docutils literal"><span class="pre">t.size</span></tt>.
One could also use <tt class="docutils literal"><span class="pre">len(t)</span></tt>, but for multi-dimensional arrays <tt class="docutils literal"><span class="pre">len</span></tt>
just gives the number of elements corresponding to the first index
(number of rows in a matrix).</p>
<p>Arrays are indexed by square brackets, and indices always start at 0.
For/do loops in Python are more general than those in Fortran, C, C++,
and Java, as one can loop over the any set of objects with the
syntax <tt class="docutils literal"><span class="pre">for</span> <span class="pre">element</span> <span class="pre">in</span> <span class="pre">some_set</span></tt>. In numerical code, it is common
to loop over array indices, i.e., a set of integers. Such a set
is produced by <tt class="docutils literal"><span class="pre">range(start,</span> <span class="pre">stop,</span> <span class="pre">increment)</span></tt>, which returns a
list of integers <tt class="docutils literal"><span class="pre">start,</span> <span class="pre">start+increment,</span> <span class="pre">start+2*increment</span></tt>, and so on,
up to <em>but not including</em> <tt class="docutils literal"><span class="pre">stop</span></tt>. Writing just <tt class="docutils literal"><span class="pre">range(stop)</span></tt> means
<tt class="docutils literal"><span class="pre">range(0,</span> <span class="pre">stop,</span> <span class="pre">1)</span></tt>. The particular call <tt class="docutils literal"><span class="pre">range(1,</span> <span class="pre">N)</span></tt> used in the code
above results in the integer sequence <tt class="docutils literal"><span class="pre">1</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt>, ..., <tt class="docutils literal"><span class="pre">N-1</span></tt>.</p>
<p>Every variable in Python is an object. In particular, the <tt class="docutils literal"><span class="pre">f</span></tt> function
above is a function object, transferred to the function as any other
object, and called as any other function. Transferring a function as
argument to another function is therefore simpler and cleaner in Python
than in, e.g., C, C++, Java, and C#.</p>
</div>
</div>
<div class="section" id="the-force">
<h2>The Force =<a class="headerlink" href="#the-force" title="Permalink to this headline">¶</a></h2>
<p>Considering the application where the present mathematical model describes
the vibrations of a vehicle driving along a bumpy road, we need
to establish the force array <tt class="docutils literal"><span class="pre">F</span></tt> from the shape of the road <span class="math">\(h(x)\)</span>.
Various shapes are
available as a file with web address <a class="reference external" href="http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz">http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz</a>. The Python functionality for downloading this <tt class="docutils literal"><span class="pre">gzip</span></tt>
compressed file as a local file <tt class="docutils literal"><span class="pre">bumpy.dat.gz</span></tt>
and reading it into a <tt class="docutils literal"><span class="pre">numpy</span></tt> array goes as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;bumpy.dat.gz&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="n">h_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>     <span class="c"># read numpy array from file</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">h_data</span></tt> object is a rectangular <tt class="docutils literal"><span class="pre">numpy</span></tt> array where the first
column contains the <span class="math">\(x\)</span> coordinates along the road and the next columns
contain various road shapes <span class="math">\(h(x)\)</span>. We can extract the <span class="math">\(x\)</span> data and
redefine <tt class="docutils literal"><span class="pre">h_data</span></tt> to contain solely the <span class="math">\(h(x)\)</span> shapes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">h_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>                <span class="c"># 1st column: x coordinates</span>
<span class="n">h_data</span> <span class="o">=</span> <span class="n">h_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>          <span class="c"># other columns: h shapes</span>
</pre></div>
</div>
<p>In general, the syntax <tt class="docutils literal"><span class="pre">a[s:t:i,2]</span></tt> gives a view (not a copy) to the part of
the array <tt class="docutils literal"><span class="pre">a</span></tt> where the first index goes from <tt class="docutils literal"><span class="pre">s</span></tt> to <tt class="docutils literal"><span class="pre">t</span></tt>,
<em>but not including</em> the <tt class="docutils literal"><span class="pre">t</span></tt> value, in increments of <tt class="docutils literal"><span class="pre">i</span></tt>, and the
second index is fixed at 2. Just writing <tt class="docutils literal"><span class="pre">:</span></tt> for an index means all
legal values of this index.</p>
<p>Given <span class="math">\(h(x)\)</span>, the corresponding acceleration <span class="math">\(a(t)\)</span> needed in the
force <span class="math">\(F(t)=-ma(t)\)</span>, follows from <span class="math">\(a(t)=h''(vt)v^2\)</span>, where <span class="math">\(v\)</span> is
the velocity of the vehicle. The compuation may utilize a finite
difference approximation for the second-order derivative and
be encapsulated in a Python function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">acceleration</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="c"># Compute 2nd-order derivative of h</span>
    <span class="n">d2h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">d2h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="c"># Extraplolate end values from first interior value</span>
    <span class="n">d2h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d2h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">d2h</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">d2h</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">d2h</span><span class="o">*</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">a</span>
</pre></div>
</div>
<p>Note that here, <tt class="docutils literal"><span class="pre">h</span></tt> is a one-dimensional array containing the <span class="math">\(h(x)\)</span>
values corresponding to a given coordinate array <tt class="docutils literal"><span class="pre">x</span></tt>. Also note that
we simply set <span class="math">\(h''(x)\)</span> at the end points equal to <span class="math">\(h''(x)\)</span> at the
closest interior point.</p>
<p>We use in this example a linear spring function <span class="math">\(f(u)\)</span>,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">k</span><span class="o">*</span><span class="n">u</span>
</pre></div>
</div>
<p>Here, <tt class="docutils literal"><span class="pre">u</span></tt> is a <em>local variable</em>,
which lives just inside in the function,
while <tt class="docutils literal"><span class="pre">k</span></tt> is a <em>global variable</em>, which must be initialized outside
the function prior to calling <tt class="docutils literal"><span class="pre">f</span></tt>.</p>
<p>Parameters can be set as <span class="math">\(m=60\)</span> kg, <span class="math">\(v=5\)</span> m/s, <span class="math">\(k=60\)</span> N/m,
and <span class="math">\(b=80\)</span> Ns/m.
This choice corresponds to a velocity of 18 km/h and a mass of 60 kg, i.e.,
bicycle conditions.</p>
<p>For each shape <span class="math">\(h(x)\)</span> we want to compute the corresponding
vertical displacement <span class="math">\(u(t)\)</span> using the mathematical model <a href="#equation-bumpy:eq1">(1)</a>.
This can be accomplished by looping over the columns of <tt class="docutils literal"><span class="pre">h_data</span></tt> and
calling <tt class="docutils literal"><span class="pre">forced_vibrations</span></tt> for each column, i.e., each realization of
the force <span class="math">\(F\)</span>.
The major arrays from the computations
are collected in a list <tt class="docutils literal"><span class="pre">data</span></tt>. The two first elements in
<tt class="docutils literal"><span class="pre">data</span></tt> are <tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">t</span></tt>. The next elements are
3-lists <tt class="docutils literal"><span class="pre">[h,</span> <span class="pre">a,</span> <span class="pre">u]</span></tt> for each road shape.
Note that some elements in <tt class="docutils literal"><span class="pre">data</span></tt> are arrays while others are list of
arrays. This composition is convenient when analyzing and visualizing
key quantities in the problem.</p>
<p>The computations of <tt class="docutils literal"><span class="pre">u</span></tt> for each road shape can be done as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>      <span class="c"># key input and output data (arrays)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">h_data</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>            <span class="c"># extract a column</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">acceleration</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">forced_vibrations</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">F</span><span class="o">=-</span><span class="n">m</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">u</span><span class="p">])</span>
</pre></div>
</div>
<p>The code above is naturally implemented as a Python function.
This function can take the most important physical parameters of the problem
as input, along with information about the file with road shapes.
We allow for defining road shapes either through a file on a web site
or a local file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve model for verticle vehicle vibrations.</span>

<span class="sd">    =========   ==============================================</span>
<span class="sd">    variable    description</span>
<span class="sd">    =========   ==============================================</span>
<span class="sd">    url         either URL of file with excitation force data,</span>
<span class="sd">                or name of a local file</span>
<span class="sd">    m           mass of system</span>
<span class="sd">    b           friction parameter</span>
<span class="sd">    k           spring parameter</span>
<span class="sd">    v           (constant) velocity of vehicle</span>
<span class="sd">    Return      data (list) holding input and output data</span>
<span class="sd">                [x, t, [h,a,u], [h,a,u], ...]</span>
<span class="sd">    =========   ==============================================</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Download file (if url is not the name of a local file)</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;http://&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;file://&#39;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">urllib</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>  <span class="c"># strip off path</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Check if url is the name of a local file</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">url</span><span class="p">,</span> <span class="s">&#39;must be a URL or a filename&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># abort program</span>
        <span class="c"># else: ok</span>

    <span class="n">h_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c"># read numpy array from file</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">h_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>                <span class="c"># 1st column: x coordinates</span>
    <span class="n">h_data</span> <span class="o">=</span> <span class="n">h_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>          <span class="c"># other columns: h shapes</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">v</span>                        <span class="c"># time corresponding to x</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">k</span><span class="o">*</span><span class="n">u</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>      <span class="c"># key input and output data (arrays)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h_data</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>            <span class="c"># extract a column</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">acceleration</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">forced_vibrations</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">F</span><span class="o">=-</span><span class="n">m</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">u</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p>Note that function arguments can be given default values (known as
<em>keyword arguments</em> in Python). Python has a lot of operating
system functionality, such as
checking if a file, directory, or link exist, creating or
removing files and directories, running stand-alone applications, etc.</p>
<p>Since the roads have a quite noise shape, the force <span class="math">\(F=-ma\)</span> looks
very noise, while the response <span class="math">\(u(t)\)</span> to this excitation is
significantly less noisy,
see Figure <a class="reference internal" href="#bumpy-fig4"><em>First realization of a bumpy road, with corresponding acceleration of the wheel and resulting vibrations</em></a> for an example.
It may be useful to compute the root mean square value of the various
realizations of <span class="math">\(u(t)\)</span> and add this array to the <tt class="docutils literal"><span class="pre">data</span></tt> list of input
and output data in the problem:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">rms</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">u_rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>  <span class="c"># for accumulating the rms value</span>
    <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>  <span class="c"># loop over results</span>
        <span class="n">u_rms</span> <span class="o">+=</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">u_rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_rms</span><span class="o">/</span><span class="n">u_rms</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_rms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p>Observe here the <tt class="docutils literal"><span class="pre">for</span></tt> loop where three variables (<tt class="docutils literal"><span class="pre">h</span></tt>, <tt class="docutils literal"><span class="pre">a</span></tt>, and <tt class="docutils literal"><span class="pre">u</span></tt>)
are set equal to the three arrays in each element of the sublist
<tt class="docutils literal"><span class="pre">data[2:]</span></tt>. We only need the <tt class="docutils literal"><span class="pre">u</span></tt> array for the computation. An alternative
loop would be to have one loop variable for each list element and
get <tt class="docutils literal"><span class="pre">u</span></tt> as the 3rd element of each list element:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>         <span class="c"># res is [h,a,u]</span>
    <span class="o">...</span>
</pre></div>
</div>
<p id="index-0">After calling</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">road_url</span> <span class="o">=</span> <span class="s">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">road_url</span><span class="p">,</span>
             <span class="n">m</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">rms</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>the <tt class="docutils literal"><span class="pre">data</span></tt> array contains single arrays and triplets of arrays,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">u</span><span class="p">],</span> <span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">u</span><span class="p">],</span> <span class="o">...</span><span class="p">,</span> <span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">u</span><span class="p">],</span> <span class="n">u_rms</span><span class="p">]</span>
</pre></div>
</div>
<p>This list, or any Python object, can be stored on file for later
retrieval of the results, using the <em>pickling</em> functionality
in Python:</p>
<div class="highlight-py"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">cPickle</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;bumpy.res&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="user-input">
<h2>User Input<a class="headerlink" href="#user-input" title="Permalink to this headline">¶</a></h2>
<p>We can in this example easily set the input data directly in
the program, e.g., in the call to the <tt class="docutils literal"><span class="pre">solve</span></tt> function, as
demonstrated above. However, most users will find it more
convenient to set parameters through a user interface rather
than editing the source code directly.</p>
<div class="section" id="positional-command-line-arguments">
<h3>Positional Command-Line Arguments<a class="headerlink" href="#positional-command-line-arguments" title="Permalink to this headline">¶</a></h3>
<p>The simplest, and often also the most effective, type of
user interface is to use the command line. Suppose <span class="math">\(m\)</span>, <span class="math">\(k\)</span>,
and <span class="math">\(v\)</span>, as well as the URL or filename for the road shapes,
are fixed parameters and that the user is allowed to vary
<span class="math">\(b\)</span> only. Then it is convenient, both for the user and
the programmer, to specify <span class="math">\(b\)</span> as the first command-line
argument to the program. If the name of the program file
is <tt class="docutils literal"><span class="pre">bumpy.py</span></tt> and <span class="math">\(b=10\)</span> is desired, we can write</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">Terminal&gt; python bumpy.py 10</span>
</pre></div>
</div>
<p>The corresponding code in the program for setting input data
and extract the user-given value of <span class="math">\(b\)</span> reads</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">prepare_input</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">80</span>  <span class="c"># default</span>
    <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>
</pre></div>
</div>
<p>The command-line arguments are available as strings in the
list <tt class="docutils literal"><span class="pre">sys.argv</span></tt>, from the element with index 1 and onward.
The first command-line argument <tt class="docutils literal"><span class="pre">sys.argv[1]</span></tt> is a string
so it must be converted to a <tt class="docutils literal"><span class="pre">float</span></tt> object (representing
real number) prior to computations. If the command-line
argument is missing, <tt class="docutils literal"><span class="pre">sys.argv[1]</span></tt> is illegal indexing
and the <tt class="docutils literal"><span class="pre">IndexError</span></tt> exception is raised. We can test for this
error and provide a default value. Without the <tt class="docutils literal"><span class="pre">try</span></tt>-<cite>except</cite>
construction, the program will abort with an error message
if no command-line argument is given.</p>
</div>
<div class="section" id="option-value-pairs-on-the-command-line">
<h3>Option-Value Pairs on the Command Line<a class="headerlink" href="#option-value-pairs-on-the-command-line" title="Permalink to this headline">¶</a></h3>
<p>Letting the user set many parameters on the command line is most
conveniently done by allowing option-value pairs, e.g.,</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">Terminal&gt; python bumpy.py --m 40 --b 280</span>
</pre></div>
</div>
<p>All parameters have a default value which can be overrided on
the command line by providing the string (option) <tt class="docutils literal"><span class="pre">--name</span></tt>, where
<tt class="docutils literal"><span class="pre">name</span></tt> is the name of the parameter, followed by the desired value of
the parameter. Implementation of option-value input is
most easily carried out using Python&#8217;s <tt class="docutils literal"><span class="pre">argparse</span></tt> module.
The recipe goes as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">command_line_options</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--m&#39;</span><span class="p">,</span> <span class="s">&#39;--mass&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;mass of vehicle&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--k&#39;</span><span class="p">,</span> <span class="s">&#39;--spring&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;spring parameter&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--b&#39;</span><span class="p">,</span> <span class="s">&#39;--damping&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;damping parameter&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--v&#39;</span><span class="p">,</span> <span class="s">&#39;--velocity&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;velocity of vehicle&#39;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--roadfile&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
              <span class="n">default</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;filename/URL with road data&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="c"># Extract input parameters</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">m</span><span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">k</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">b</span><span class="p">;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">v</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">roadfile</span>
    <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>
</pre></div>
</div>
<p>We may offer two options for each parameter, one reflecting the
mathematical symbol (like <tt class="docutils literal"><span class="pre">--v</span></tt>) and one more descriptive text
(like <tt class="docutils literal"><span class="pre">--velocity-</span></tt>).</p>
<p>The file <a class="reference external" href="_static-bumpy/bumpy.py">_static-bumpy/bumpy.py</a> contains the complete code
for downloading road shapes and solving the problem with aid of the
code snippets above.</p>
</div>
</div>
<div class="section" id="visual-exploration">
<h2>Visual Exploration<a class="headerlink" href="#visual-exploration" title="Permalink to this headline">¶</a></h2>
<p>This section explains how to load the data from the computation, stored
as a pickled list in the file <tt class="docutils literal"><span class="pre">bumpy.res</span></tt>, into various arrays, and how
to visualize these arrays. We want to produce the following plots:</p>
<blockquote>
<div><ul class="simple">
<li>the root mean square value of <span class="math">\(u(t)\)</span>, to see the typical amplitudes</li>
<li>the spectrum of <span class="math">\(u(t)\)</span>, for <span class="math">\(t&gt;t_s\)</span> (using FFT) to see which frequencies
that dominate in the signal</li>
<li>for each road shape, a plot of <span class="math">\(h(x)\)</span>, <span class="math">\(a(t)\)</span>, and <span class="math">\(u(t)\)</span>, for
<span class="math">\(t\geq t_s\)</span></li>
</ul>
</div></blockquote>
<p>We use Matplotlib&#8217;s <tt class="docutils literal"><span class="pre">pylab</span></tt> module for curve plotting since it provides
a syntax very close to that of MATLAB, which is well known by many readers.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">matplotlib.pylab</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>This import also perform as <tt class="docutils literal"><span class="pre">from</span> <span class="pre">numpy</span> <span class="pre">import</span> <span class="pre">*</span></tt> such that we have access
to all the array functionality too.</p>
<p>Loading the computational data from file back to a list <tt class="docutils literal"><span class="pre">data</span></tt> is done
by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">cPickle</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;bumpy.res&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">x</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">u_rms</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>The remaining data, <tt class="docutils literal"><span class="pre">data[2:-1]</span></tt>, contains all the 3-lists <tt class="docutils literal"><span class="pre">[h,</span> <span class="pre">a,</span> <span class="pre">u]</span></tt>
from the computations in the function <tt class="docutils literal"><span class="pre">forced_vibrations</span></tt>.</p>
<p>Since now we concentrate on the part <span class="math">\(t\geq t_s\)</span> of the data, we
can grab the corresponding parts of the arrays in the following way,
using boolean arrays as indices:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">indices</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">t_s</span>   <span class="c"># True/False boolean array</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>       <span class="c"># fetch the part of t for which t &gt; t_s</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>       <span class="c"># fetch the part of x for which t &gt; t_s</span>
</pre></div>
</div>
<p>Indexing by a boolean array extracts all the elements corresponding to
the <tt class="docutils literal"><span class="pre">True</span></tt> elements in the index array.</p>
<p>Plotting the root mean square value array <tt class="docutils literal"><span class="pre">u_rms</span></tt> for <tt class="docutils literal"><span class="pre">t</span> <span class="pre">&gt;=</span> <span class="pre">t_s</span></tt> is now done by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">figure</span><span class="p">()</span>
<span class="n">u_rms</span> <span class="o">=</span> <span class="n">u_rms</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_rms</span><span class="p">)</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;u&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Root mean square value of u(t) functions&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Figure <a class="reference internal" href="#bumpy-fig3"><em>Root mean square of displacement</em></a> shows the result.</p>
<div class="figure" id="bumpy-fig3">
<img alt="_images/u_rms.png" src="_images/u_rms.png" style="width: 600px;" />
<p class="caption"><em>Root mean square of displacement</em></p>
</div>
<p>The spectrum of a <span class="math">\(u(t)\)</span> function (represented through the arrays <tt class="docutils literal"><span class="pre">u</span></tt>
and <tt class="docutils literal"><span class="pre">t</span></tt>) can be computed by the Python function</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">frequency_analysis</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">A</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">size</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="o">/</span><span class="n">dt</span>
    <span class="n">A</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">])</span><span class="o">/</span><span class="n">N</span>
    <span class="c"># Remove small high frequency part</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">A</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">freq</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">A</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Note here that we truncate that last part of the spectrum where the
amplitudes are small (this usually gives a plot that is easier to inspect).</p>
<p>In the present case, we utilize the <tt class="docutils literal"><span class="pre">frequency_analysis</span></tt> through</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">figure</span><span class="p">()</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">indices</span><span class="p">]</span>  <span class="c"># 2nd realization of u</span>
<span class="n">f</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">frequency_analysis</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Spectrum of u&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the list look-up <tt class="docutils literal"><span class="pre">data[3][2][indices]</span></tt>: the element with index
3 contains the 2nd 3-list <tt class="docutils literal"><span class="pre">[h,</span> <span class="pre">a,</span> <span class="pre">u]</span></tt>, and the element with index 2
in this 3-list is the <tt class="docutils literal"><span class="pre">u</span></tt> array, in which we seek the part where
<span class="math">\(t\geq t_s\)</span>, here corresponding to the <tt class="docutils literal"><span class="pre">True</span></tt> indices in the boolean
array <tt class="docutils literal"><span class="pre">indices</span></tt>.</p>
<p>Figure <a class="reference internal" href="#bumpy-fig2"><em>Spectrum of displacement</em></a> shows the amplitudes and that the
dominating frequency is 1 Hz.</p>
<div class="figure" id="bumpy-fig2">
<img alt="_images/u_spectrum.png" src="_images/u_spectrum.png" style="width: 600px;" />
<p class="caption"><em>Spectrum of displacement</em></p>
</div>
<p>Finally, we can run through all the 3-lists <tt class="docutils literal"><span class="pre">[h,</span> <span class="pre">a,</span> <span class="pre">u]</span></tt> and plot
these arrays:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">case_counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

    <span class="n">figure</span><span class="p">()</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="s">&#39;g-&#39;</span><span class="p">)</span>
    <span class="n">legend</span><span class="p">([</span><span class="s">&#39;h </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">case_counter</span><span class="p">])</span>
    <span class="n">hmax</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">axis</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">hmax</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">hmax</span><span class="o">*</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;distance&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">)</span>

    <span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">legend</span><span class="p">([</span><span class="s">&#39;a </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">case_counter</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acceleration&#39;</span><span class="p">)</span>

    <span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">legend</span><span class="p">([</span><span class="s">&#39;u </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">case_counter</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;displacement&#39;</span><span class="p">)</span>
    <span class="n">savefig</span><span class="p">(</span><span class="s">&#39;tmp</span><span class="si">%d</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="n">case_counter</span><span class="p">)</span>
    <span class="n">case_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="figure" id="bumpy-fig4">
<img alt="_images/hau0.png" src="_images/hau0.png" style="width: 700px;" />
<p class="caption"><em>First realization of a bumpy road, with corresponding acceleration of the wheel and resulting vibrations</em></p>
</div>
<div class="figure" id="bumpy-fig5">
<img alt="_images/hau1.png" src="_images/hau1.png" style="width: 700px;" />
<p class="caption"><em>Second realization of a bumpy road, with corresponding acceleration of the wheel and resulting vibrations</em></p>
</div>
<div class="figure" id="bumpy-fig6">
<img alt="_images/hau2.png" src="_images/hau2.png" style="width: 700px;" />
<p class="caption"><em>Third realization of a bumpy road, with corresponding acceleration of the wheel and resulting vibrations</em></p>
</div>
<p>If all the plot commands above are placed in a file, as in
<a class="reference external" href="_static-bumpy/explore.py">_static-bumpy/explore.py</a>, a final <tt class="docutils literal"><span class="pre">show()</span></tt> call is needed to show the
plots on the screen. On the other hand, the commands are usually
more conveniently performed in an interactive Python shell, preferably
IPython.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">A Worked Example on Scientific Computing with Python</a><ul>
<li><a class="reference internal" href="#physical-problem">Physical Problem</a></li>
<li><a class="reference internal" href="#numerical-model-and-implementation">Numerical Model and Implementation</a><ul>
<li><a class="reference internal" href="#dissection-of-the-code">Dissection of the Code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-force">The Force =</a></li>
<li><a class="reference internal" href="#user-input">User Input</a><ul>
<li><a class="reference internal" href="#positional-command-line-arguments">Positional Command-Line Arguments</a></li>
<li><a class="reference internal" href="#option-value-pairs-on-the-command-line">Option-Value Pairs on the Command Line</a></li>
</ul>
</li>
<li><a class="reference internal" href="#visual-exploration">Visual Exploration</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">A Worked Example on Scientific Computing with Python: Vehicle on Bumpy Road</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="index.html" title="A Worked Example on Scientific Computing with Python: Vehicle on Bumpy Road"
             >previous</a> |</li>
        <li><a href="index.html">A Worked Example on Scientific Computing with Python: Vehicle on Bumpy Road 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Hans Petter Langtangen.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>